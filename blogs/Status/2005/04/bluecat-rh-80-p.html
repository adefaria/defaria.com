<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="This status entry is to hold a log of the issues and resolutions for getting the Bluecat build process from the ancient RH 6.1 to the a little less ancient RH 8.0. Fun with eval, echo and new shell Bug...">
    <meta name="generator" content="Movable Type 5.2.3">
    <title>Bluecat RH 8.0 port - Status</title>
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="http://defaria.com/blogs/Status/atom.xml">
    <link rel="canonical" href="http://defaria.com/blogs/Status/2005/04/bluecat-rh-80-p.html">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles.css">
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles_ie.css">
    <script src="/mt/mt-static/support/theme_static/rainier/js/html5shiv.js"></script>
    <![endif]-->
    
    <link rel="start" href="http://defaria.com/blogs/Status/">

    <link rel="prev" href="http://defaria.com/blogs/Status/2005/04/hybrid-os-1.html" title="Hybrid OS">
    <link rel="next" href="http://defaria.com/blogs/Status/2005/04/los178-300.html" title="LOS178 3.0.0">
    <!-- Open Graph Protocol -->
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-us">
    <meta property="og:title" content="Bluecat RH 8.0 port">
    <meta property="og:url" content="http://defaria.com/blogs/Status/2005/04/bluecat-rh-80-p.html">
    <meta property="og:description" content="This status entry is to hold a log of the issues and resolutions for getting the Bluecat build process from the ancient RH 6.1 to the a little less ancient RH 8.0. Fun with eval, echo and new shell Bug...">
    <meta property="og:site_name" content="Status">
    <meta property="og:image" content="/mt/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    <!-- Metadata -->
    <meta itemprop="description" content="This status entry is to hold a log of the issues and resolutions for getting the Bluecat build process from the ancient RH 6.1 to the a little less ancient RH 8.0. Fun with eval, echo and new shell Bug...">
    <link itemprop="url" href="http://defaria.com/blogs/Status/2005/04/bluecat-rh-80-p.html">
    <link itemprop="image" href="/mt/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    
  </head>
  <body>
    <div id="container">
      <div id="container-inner">
        <header id="header" role="banner">
          <div id="header-inner">
            <div id="header-content">
              <h1>
                <a href="http://defaria.com/blogs/Status/">

                  Status

                </a>
              </h1>
              
            </div>

            <nav role="navigation">
          <ul>
            <li><a href="http://defaria.com/blogs/Status/">Home</a></li>


          </ul>
        </nav>

          </div>
        </header>
        <div id="content">
          <div id="content-inner">
            <ul class="breadcrumb breadcrumb-list">
              <li class="breadcrumb-list-item"><a href="http://defaria.com/blogs/Status/">Home</a></li>
              <li class="breadcrumb-list-item">Bluecat RH 8.0 port</li>
            </ul>
            <div id="individual-main" class="main" role="main">
              <article id="entry-1604" class="entry entry-asset asset hentry">
                <div class="asset-header">
                  <h2 itemprop="name" class="asset-name entry-title">Bluecat RH 8.0 port</h2>
                  <footer class="asset-meta">
                    <ul class="asset-meta-list">
                      <li class="asset-meta-list-item">Posted on <time datetime="2005-04-07T10:39:43-08:00" itemprop="datePublished">April  7, 2005</time></li>
                      <li class="asset-meta-list-item">by <span class="author entry-author vcard"></span></li>

  
                      <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="http://defaria.com/blogs/Status/lynuxworks/">LynuxWorks</a></li>
  

                   </ul>
                </footer>
                </div>
                <div class="entry-content asset-content" itemprop="articleBody">
                  <p>This status entry is to hold a log of the issues and resolutions for getting the Bluecat build process from the ancient RH 6.1 to the <i>a little less ancient</i> RH 8.0.</p>

<ol>
  <li>Fun with eval, echo and new shell</li>

  <li>Bug in rpm configure</li>

  <li>Static vs. Shared</li>
</ol>
                  <h3>Fun with eval, echo and new shell</h3>

<p>One of the things that the Bluecat do_it script does is to define the series of "steps" that need to be performed in terms of command lines in variables. Later on the $BUILD_STEP is evaluated to determine which set of commands need to be done as follows:</p>

<div class="code"><pre>
echo "---- Step $BUILD_STEP started at `date` ----"
su $BUILD_CMD_OWNER -c "mkdir -p $LOGS_PREFIX/step${BUILD_STEP}"
cmd=`eval echo $"STEP${BUILD_STEP}_CMD"`
su $BUILD_CMD_OWNER -c "$cmd $*"
</pre></div>

<p>Effectively the name of the environment variable holding the proper command(s) for the step is composed with the echo portion. The eval statement is used to "evaluate" that environment variable thus storing the string of commands into the environment variable cmd. This works well in past versions of the OS but it fails in RH 8.0. First here's the behavior on RH 6.1:</p>

<div class="code"><pre>
<font color="blue"><b>RH6.1:</b></font><u>export STEP1_CMD="ls /tmp"</u>
<font color="blue"><b>RH6.1:</b></font><u>export BUILD_STEP=1</u>
<font color="blue"><b>RH6.1:</b></font><u>echo $"STEP${BUILD_STEP}_CMD"</u>
$STEP1_CMD
</pre></div>

<p>However hears the same commands on RH8.0:</p>

<div class="code"><pre>
<font color="red"><b>RH8.0:</b></font><u>export STEP1_CMD="ls /tmp"</u>
<font color="red"><b>RH8.0:</b></font><u>export BUILD_STEP=1</u>
<font color="red"><b>RH8.0:</b></font><u>echo $"STEP${BUILD_STEP}_CMD"</u>
STEP1_CMD
</pre></div>

<p>As you can see the result is missing a $. Prepending a leading \ before the $ fixes this. Adding in the eval portion also works:</p>

<div class="code"><pre>
<font color="red"><b>RH8.0:</b></font><u>eval echo \$"STEP${BUILD_STEP}_CMD"</u>
ls /tmp
</pre></div>

<p>However when this is assigned to another environment variable (i.e. cmd) the result is not correct:</p>

<div class="code"><pre>
<font color="red"><b>RH8.0:</b></font><u>cmd=`eval echo \$"STEP${BUILD_STEP}_CMD"`</u>
<font color="red"><b>RH8.0:</b></font><u>echo $cmd</u>
STEP1_CMD
</pre></div>

<p>Subsituting the syntax of $(<command>) for `<command` however does work:</p>

<div class="code"><pre>
<font color="red"><b>RH8.0:</b></font><u>cmd=$(eval echo \$"STEP${BUILD_STEP}_CMD")</u>
<font color="red"><b>RH8.0:</b></font><u>echo $cmd</u>
ls /tmp
</pre></div>

<p>Note that the shell (bash) has been majorly updated for RH8.0:</p>

<div class="code"><pre>
<font color="blue"><b>RH6.1:</b></font><u>bash -version</u>
GNU bash, version 1.14.7(1)
</pre></div>

<p>Versus:</p>

<div class="code"><pre>
<font color="red"><b>RH8.0:</b></font><u>bash -version</u>
GNU bash, version 2.05b.0(1)-release (i686-pc-linux-gnu)
Copyright (C) 2002 Free Software Foundation, Inc.
</pre></div>

<p>Please note that this new syntax also works flawlessly on the older RH 6.1.</p>

<h3>Bug in rpm configure</h3>

<p>When trying to build Bluecat on RH 8.0 and running mktools (to build the local gnutools) I get the following:</p>

<div class="code"><pre>
[int@europa make]$ autoreconf -f -i
autoreconf: `aclocal.m4' is updated
Makefile.am: installing `./depcomp'
WARNING: Using auxiliary files such as `acconfig.h', `config.h.bot'
WARNING: and `config.h.top', to define templates for `config.h.in'
WARNING: is deprecated and discouraged.

WARNING: Using the third argument of `AC_DEFINE' and
WARNING: `AC_DEFINE_UNQUOTED' allows to define a template without
WARNING: `acconfig.h':

WARNING:   AC_DEFINE([NEED_MAIN], 1,
WARNING:             [Define if a function `main' is needed.])

WARNING: More sophisticated templates can also be produced, see the
WARNING: documentation.
autoheader-2.53: `config.h.in' is updated
</pre></div>

<p>Further, after running configure I get the following odd file in /usr/local/bluecat/eng/bluecat/make/.deps: remote-$(REMOTE).Po which causes the make to fail:</p>

<div class="code"><pre>
[int@europa make]$ make
Makefile:329: .deps/remote-stub.Po: No such file or directory
make: *** No rule to make target `.deps/remote-stub.Po'.  Stop.
</pre></div>

<p>Renaming .deps/remote-$(REMOTE).Po -> .deps/remote-stub.Po allows the make to proceed.</p>

<h3>Static vs. Shared - Cannot find -lnss_dns</h3>

<p>During the first real build step, step 2, the build fails when trying to build rpm. ld is unable to find the library nss_dns. Initial investigation shows that there is a nss_dns libs under /usr/lib as .so files but there is no .a file on RH 8.0. There is a .a file on RH 6.1 in /usr/lib. Apparently RH 8.0 no longer offers archive libraries for this. The solution to this problem is to pass -shared to gcc.</p>

<p>The specific gcc command line is:</p>

<div class="code"><pre>
<font color="blue"><b>int@europa tools:</b></font><u>pwd</u>
/var/tmp/rpm-4.2/tools
<font color="blue"><b>int@europa tools:</b></font><u>gcc -Wl,--verbose -O2 -D_GNU_SOURCE -D_REENTRANT -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wno-char-subscripts -o rpmgraph <font color="red"><b>-static</b></font> rpmgraph.o  ../lib/.libs/librpm.a /var/tmp/rpm-4.2/rpmdb/.libs/librpmdb.a -L/var/tmp/rpm-4.2/zlib -L/usr/local/lib /var/tmp/rpm-4.2/rpmio/.libs/librpmio.a /var/tmp/rpm-4.2/popt/.libs/libpopt.a ../beecrypt/.libs/libbeecrypt.a -lrt -lpthread -lc -lnss_dns -lnss_files -lresolv</u>
...
(/usr/lib/gcc-lib/i386-redhat-linux/3.2/../../../libc.a)truncate64.o
(/usr/lib/gcc-lib/i386-redhat-linux/3.2/../../../libc.a)truncate.o
attempt to open /var/tmp/rpm-4.2/zlib/libnss_dns.a failed
attempt to open /usr/local/lib/libnss_dns.a failed
attempt to open /usr/lib/gcc-lib/i386-redhat-linux/3.2/libnss_dns.a failed
attempt to open /usr/lib/gcc-lib/i386-redhat-linux/3.2/../../../libnss_dns.a failed
attempt to open /usr/i386-redhat-linux/lib/libnss_dns.a failed
attempt to open /usr/lib/libnss_dns.a failed
attempt to open /usr/local/lib/libnss_dns.a failed
attempt to open /lib/libnss_dns.a failed
collect2: ld returned 1 exit status
</pre></div>

<p>This is probably due to the -static above. Removing -static fixes this. The question is: Is it OK to remove -static? Second question is how?</p>
                </div>
                <nav class="page-navigation entry-navigation pagination content-nav">
                  <ul class="page-navigation-list">

                    <li class="page-navigation-list-item page-navigation-prev"><a rel="prev" href="http://defaria.com/blogs/Status/2005/04/hybrid-os-1.html" title="Hybrid OS">Previous entry</a></li>


                    <li class="page-navigation-list-item page-navigation-next"><a rel="next" href="http://defaria.com/blogs/Status/2005/04/los178-300.html" title="LOS178 3.0.0">Next entry</a></li>

                  </ul>
                </nav>
                <!--
<aside id="zenback" class="zenback feedback">
  Please paste Zenback script code here.
</aside>
-->
                
                
              </article>
            </div>
            <aside class="widgets related" role="complementary">
              <nav class="widget-search widget">
  <div class="widget-content">
    <form method="get" id="search" action="http://defaria.com/mt/mt-search.cgi">
      <div>
        <input type="text" name="search" value="" placeholder="Search...">

        <input type="hidden" name="IncludeBlogs" value="8">

        <input type="hidden" name="limit" value="20">
        <button type="submit" name="button">
          <img alt="Search" src="/mt/mt-static/support/theme_static/rainier/img/search-icon.png">
        </button>
      </div>
    </form>
  </div>
</nav>
<nav class="widget-archive-category widget">
  <h3 class="widget-header">Categories</h3>
  <div class="widget-content">
    
      
    <ul class="widget-list">
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/ameriquest/">Ameriquest (99)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/audience/">Audience (3)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/broadcom/">Broadcom (76)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/gpdb/">GPDB (35)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/general-dynamics/">General Dynamics (61)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/general-electric/">General Electric (13)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/hewlett-packard/">Hewlett Packard (13)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/lynuxworks/">LynuxWorks (162)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/pqa/">PQA (35)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/salira/">Salira (79)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/tellabs/">Tellabs (2)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/texas-instruments/">Texas Instruments (31)</a>
      
      
      </li>
      
    </ul>
      
    
  </div>
</nav>
  

<nav class="widget-archive-dropdown widget">
  <h3 class="widget-header">Archives</h3>
  <div class="widget-content">
    <select>
      <option>Select a Month...</option>
    
      <option value="http://defaria.com/blogs/Status/2016/02/">February 2016</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/09/">September 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/04/">April 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/03/">March 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2013/02/">February 2013</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/09/">September 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/08/">August 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/05/">May 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/04/">April 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/02/">February 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/01/">January 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2011/10/">October 2011</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2011/07/">July 2011</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/09/">September 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/08/">August 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/04/">April 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/03/">March 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/02/">February 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2009/05/">May 2009</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2009/04/">April 2009</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/07/">July 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/05/">May 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/04/">April 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/03/">March 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/02/">February 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/01/">January 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/12/">December 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/11/">November 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/10/">October 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/09/">September 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/08/">August 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/07/">July 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/06/">June 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/05/">May 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/04/">April 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/03/">March 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/01/">January 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/12/">December 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/11/">November 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/10/">October 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/09/">September 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/07/">July 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/06/">June 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/05/">May 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/04/">April 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/03/">March 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/02/">February 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/01/">January 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/12/">December 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/11/">November 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/10/">October 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/09/">September 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/08/">August 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/07/">July 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/06/">June 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/05/">May 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/04/">April 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/03/">March 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/02/">February 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/01/">January 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/12/">December 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/09/">September 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/08/">August 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/07/">July 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/06/">June 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/05/">May 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/04/">April 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/03/">March 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/02/">February 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/01/">January 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2003/12/">December 2003</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2003/11/">November 2003</option>
    
    </select>
  </div>
</nav>
    
  

<div class="widget-syndication widget section">
  <div class="widget-content">
    <p><img src="http://defaria.com/mt/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="http://defaria.com/blogs/Status/atom.xml">Subscribe to this blog's feed</a></p>

  </div>
</div>

            </aside>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
          <div id="footer-inner">
            <div id="footer-content">
  <nav role="navigation">
          <ul>
            <li><a href="http://defaria.com/blogs/Status/">Home</a></li>


          </ul>
        </nav>

  <p class="license">&copy; Copyright 2016.</p>
  <p class="poweredby">Powered by <a href="http://www.movabletype.org/">Movable Type</a></p>
</div>
          </div>
        </footer>
      </div>
    </div>
    <script src="http://defaria.com/mt/mt-static/jquery/jquery.min.js"></script>
    <script src="http://defaria.com/blogs/Status/mt-theme-scale2.js"></script>
  </body>
</html>
