<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Using PDSQL to update Clearquest databases Often when you add a new field to a Clearquest database you need to tackle the problem of how to update or set the value on all of your old records. Often specialized scripts...">
    <meta name="generator" content="Movable Type 5.2.3">
    <title>Using PDSQL to update Clearquest databases - Status</title>
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="http://defaria.com/blogs/Status/atom.xml">
    <link rel="canonical" href="http://defaria.com/blogs/Status/2012/02/using-pdsql-to.html">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles.css">
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles_ie.css">
    <script src="/mt/mt-static/support/theme_static/rainier/js/html5shiv.js"></script>
    <![endif]-->
    
    <link rel="start" href="http://defaria.com/blogs/Status/">

    <link rel="prev" href="http://defaria.com/blogs/Status/2012/01/outlook-top-pos.html" title="Outlook Top Posting">
    <link rel="next" href="http://defaria.com/blogs/Status/2012/04/perlcritic-1.html" title="Perl::Critic">
    <!-- Open Graph Protocol -->
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-us">
    <meta property="og:title" content="Using PDSQL to update Clearquest databases">
    <meta property="og:url" content="http://defaria.com/blogs/Status/2012/02/using-pdsql-to.html">
    <meta property="og:description" content="Using PDSQL to update Clearquest databases Often when you add a new field to a Clearquest database you need to tackle the problem of how to update or set the value on all of your old records. Often specialized scripts...">
    <meta property="og:site_name" content="Status">
    <meta property="og:image" content="/mt/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    <!-- Metadata -->
    <meta itemprop="description" content="Using PDSQL to update Clearquest databases Often when you add a new field to a Clearquest database you need to tackle the problem of how to update or set the value on all of your old records. Often specialized scripts...">
    <link itemprop="url" href="http://defaria.com/blogs/Status/2012/02/using-pdsql-to.html">
    <link itemprop="image" href="/mt/mt-static/support/theme_static/rainier/img/siteicon-sample.png">
    
  </head>
  <body>
    <div id="container">
      <div id="container-inner">
        <header id="header" role="banner">
          <div id="header-inner">
            <div id="header-content">
              <h1>
                <a href="http://defaria.com/blogs/Status/">

                  Status

                </a>
              </h1>
              
            </div>

            <nav role="navigation">
          <ul>
            <li><a href="http://defaria.com/blogs/Status/">Home</a></li>


          </ul>
        </nav>

          </div>
        </header>
        <div id="content">
          <div id="content-inner">
            <ul class="breadcrumb breadcrumb-list">
              <li class="breadcrumb-list-item"><a href="http://defaria.com/blogs/Status/">Home</a></li>
              <li class="breadcrumb-list-item">Using PDSQL to update Clearquest databases</li>
            </ul>
            <div id="individual-main" class="main" role="main">
              <article id="entry-1971" class="entry entry-asset asset hentry">
                <div class="asset-header">
                  <h2 itemprop="name" class="asset-name entry-title">Using PDSQL to update Clearquest databases</h2>
                  <footer class="asset-meta">
                    <ul class="asset-meta-list">
                      <li class="asset-meta-list-item">Posted on <time datetime="2012-02-13T15:10:03-08:00" itemprop="datePublished">February 13, 2012</time></li>
                      <li class="asset-meta-list-item">by <span class="author entry-author vcard"></span></li>

  
                      <li class="asset-meta-list-item">in <a itemprop="articleSection" rel="tag" href="http://defaria.com/blogs/Status/broadcom/">Broadcom</a></li>
  

                   </ul>
                </footer>
                </div>
                <div class="entry-content asset-content" itemprop="articleBody">
                  <h2>Using PDSQL to update Clearquest databases</h2>

<p>Often when you add a new field to a Clearquest database you need to tackle the problem of how to update or set the value on all of your old records. Often specialized scripts are created to say set the new field to some known value in all of the older records by using the Clearquest API. This takes time to write such scripts and it takes time to run because all of the action hook code needs to be executed to validate the record, etc. Often this is needless rechecking of already correct values of all of the fields in the record. Updates of this kind can take literally hours to process large numbers of records and have all of that action hook code run for no particular reason.</p>

<p>There is a utility in C:\Program Files\IBM\RationalSDLC\ClearQuest named pdsql. It provides a command line interface to the database directly which you can use to perform updates of fields in a lightning fast manner. The updating of all defect records setting a new field to say "foo" would take literally hours using the Clearquest API but less than a second or two in pdsql.</p>
                  <h3>Running PDSQL</h3>

<p>You should have C:\Program Files\IBM\RationalSDLC\ClearQuest in your PATH. When you start up pdsql you need to specify a lot of parameters to connect to the database. Remember you are talking to the database so you must use the true database name, not the Clearquest database name. You can use pdsql -help to see the help usage but usually you'll specify the following parameters:</p>

<div class=code><pre>
$ pdsql -u &lt;username&gt; -p &lt;password&gt; -v ss -s &lt;server&gt; -db &lt;database&gt;
</pre></div>

<p>Note that the username (-u) is the database username. Also the -db is the database name not the Clearquest database name. The -v ss stands for SQLServer and -s is the server name. for ease I have a simply Bash script to get into pdsql that I've named cqsql.sh:</p>

<div class=code><pre>
Ltsdo-adefaria:cat /mcsi/scm_tools/cq/cqsql.sh
#!/bin/bash
if [ $# -ne 1 ]; then
  echo "Usage: cqsql <db>"
  exit 1
fi
 
if [ -n "$(type -p rlwrap)" ]; then
  rlwrap=rlwrap
fi
 
$rlwrap pdsql -u &lt;username&gt; -p &lt;password&gt; -v ss -s &lt;server&gt; -db $1
</pre></div>

<p>Once in pdsql you can issue SQL statements. Note that ';' is required to terminate all commands - even quit! Also note there is no command line history and very poor editing. If, for example, you forget and do say an up arrow you have put unprintable characters in your command line and your command will fail. If you use Cygwin and have installed the wonderful utility rlwrap (readline wrap) then you will have a full, bash like command history which is extremely useful!</p>

<h3>Issuing SQL commands</h3>

<p>Remember, you are talking to the back end database directly so all field names will be the database field names shown in Clearquest Designer - not the field names that Clearquest users use. Some useful, non SQL commands are tables; and columns <tablename>;. These commands show the table names in the database and the columns in the a particular table.</p>

<p>Most standard SQL commands work as expected. Here is an example session where I used pdsql to set Reproducible to the string "NO" if it was previously NULL (New short strings are set to NULL when a field is added to a record).</p>

<div class=code><pre>
>select count(*) from defect where reproducible is not null;
 
   <EXPR-1>
         11
 
>select reproducible from defect where reproducible is not null;
 
                           reproducible
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                                NO
                                               YES
 
>update defect set reproducible = 'NO' where reproducible  is null;
93326 rows affected.
>
</pre></div>

<p>I used to the count(*) syntax to determine how many of the defect records had reproducible not set to NULL. These would be from any new records created since the action hook code makes sure to set this field to either "YES" or "NO". It's the old records we need to set to "NO" if they were NULL. Since there were only 11 records that were not null I decided to see what they contained. Good, they contain what I expect - "NO"'s and "YES"'s only. Then the simple update command to set reproducible = 'NO' if it was null. This command took a second or two to update 93326 defects!</p>

<h3>Setting a reference field</h3>

<p>When you look into the database directly you start learning how Clearquest does some of its magic. For a reference field one does not see the key to the reference field in textual form rather one sees an integer field, a dbid. Records have a dbid which allows direct access to the particular record. This way if the textual representation of the key (i.e. Name in the Certification stateless record as shown here) you only need update one record instead of potentially thousands of referenced records.</p>

<p>So then how do you change a reference field? The trick is to find the dbid for that stateless record and plop it into the record that references it. Unfortunately, when the stateless record Certification was created its internal table name was never changed from the default "new1" so we need to use the database name for this table - new1. We select the fields for new1 to reveal that 35541127 is the dbid for the "N/A" record in Certification. We then do a small test changing only one record - DB00031023 - carriercertification reference from 0 -> 35541127. Next I checked that this defect (DB00031023) had a Certification of "N/A" in the Clearquest client. It did. So I know this method works.</p>

<div class=code><pre>
>select * from new1;
 
       dbid   is_active     version lock_version   locked_by ratl_mastership ratl_keysite          name
          0        NULL           1            0           0               0            0          NULL
   35541119           1           1            0           0        16777313     16777313          Grade A
   35541121           1           1            0           0        16777313     16777313          Grade B
   35541123           1           1            0           0        16777313     16777313          Grade C
   35541125           1           1            0           0        16777313     16777313          Grade D
   35541127           1           1            0           0        16777313     16777313          N/A
 
>select certification from defect where id='DB00031023';
 
certification
                   0
 
>update defect set certification=35541127 where id='DB00031023';
1 rows affected.
 
>select id from defect where id='DB00031024' and certification = 0;
 
           id
DB00031024
 
 
>select id from defect where id='DB00031024' and certification = 1;
 
           id
 
>select count(*) from defect;
   <EXPR-1>
      93407
 
>select count(*) from defect where certification = 0;
   <EXPR-1>
      93026
 
>update defect set certification = 35541127 where certification= 0;
93025 rows affected.
</pre></div>
                </div>
                <nav class="page-navigation entry-navigation pagination content-nav">
                  <ul class="page-navigation-list">

                    <li class="page-navigation-list-item page-navigation-prev"><a rel="prev" href="http://defaria.com/blogs/Status/2012/01/outlook-top-pos.html" title="Outlook Top Posting">Previous entry</a></li>


                    <li class="page-navigation-list-item page-navigation-next"><a rel="next" href="http://defaria.com/blogs/Status/2012/04/perlcritic-1.html" title="Perl::Critic">Next entry</a></li>

                  </ul>
                </nav>
                <!--
<aside id="zenback" class="zenback feedback">
  Please paste Zenback script code here.
</aside>
-->
                
                
              </article>
            </div>
            <aside class="widgets related" role="complementary">
              <nav class="widget-search widget">
  <div class="widget-content">
    <form method="get" id="search" action="http://defaria.com/mt/mt-search.cgi">
      <div>
        <input type="text" name="search" value="" placeholder="Search...">

        <input type="hidden" name="IncludeBlogs" value="8">

        <input type="hidden" name="limit" value="20">
        <button type="submit" name="button">
          <img alt="Search" src="/mt/mt-static/support/theme_static/rainier/img/search-icon.png">
        </button>
      </div>
    </form>
  </div>
</nav>
<nav class="widget-archive-category widget">
  <h3 class="widget-header">Categories</h3>
  <div class="widget-content">
    
      
    <ul class="widget-list">
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/ameriquest/">Ameriquest (99)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/audience/">Audience (3)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/broadcom/">Broadcom (76)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/gpdb/">GPDB (35)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/general-dynamics/">General Dynamics (61)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/general-electric/">General Electric (13)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/hewlett-packard/">Hewlett Packard (13)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/lynuxworks/">LynuxWorks (162)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/pqa/">PQA (35)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/salira/">Salira (79)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/tellabs/">Tellabs (2)</a>
      
      
      </li>
      
    
      
      
      <li class="widget-list-item"><a href="http://defaria.com/blogs/Status/texas-instruments/">Texas Instruments (31)</a>
      
      
      </li>
      
    </ul>
      
    
  </div>
</nav>
  

<nav class="widget-archive-dropdown widget">
  <h3 class="widget-header">Archives</h3>
  <div class="widget-content">
    <select>
      <option>Select a Month...</option>
    
      <option value="http://defaria.com/blogs/Status/2016/02/">February 2016</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/09/">September 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/04/">April 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2014/03/">March 2014</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2013/02/">February 2013</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/09/">September 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/08/">August 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/05/">May 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/04/">April 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/02/">February 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2012/01/">January 2012</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2011/10/">October 2011</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2011/07/">July 2011</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/09/">September 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/08/">August 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/04/">April 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/03/">March 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2010/02/">February 2010</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2009/05/">May 2009</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2009/04/">April 2009</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/07/">July 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/05/">May 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/04/">April 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/03/">March 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/02/">February 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2008/01/">January 2008</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/12/">December 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/11/">November 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/10/">October 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/09/">September 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/08/">August 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/07/">July 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/06/">June 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/05/">May 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/04/">April 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/03/">March 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2007/01/">January 2007</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/12/">December 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/11/">November 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/10/">October 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/09/">September 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/07/">July 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/06/">June 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/05/">May 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/04/">April 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/03/">March 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/02/">February 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2006/01/">January 2006</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/12/">December 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/11/">November 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/10/">October 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/09/">September 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/08/">August 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/07/">July 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/06/">June 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/05/">May 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/04/">April 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/03/">March 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/02/">February 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2005/01/">January 2005</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/12/">December 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/09/">September 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/08/">August 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/07/">July 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/06/">June 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/05/">May 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/04/">April 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/03/">March 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/02/">February 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2004/01/">January 2004</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2003/12/">December 2003</option>
    
  
    
      <option value="http://defaria.com/blogs/Status/2003/11/">November 2003</option>
    
    </select>
  </div>
</nav>
    
  

<div class="widget-syndication widget section">
  <div class="widget-content">
    <p><img src="http://defaria.com/mt/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="http://defaria.com/blogs/Status/atom.xml">Subscribe to this blog's feed</a></p>

  </div>
</div>

            </aside>
          </div>
        </div>
        <footer id="footer" role="contentinfo">
          <div id="footer-inner">
            <div id="footer-content">
  <nav role="navigation">
          <ul>
            <li><a href="http://defaria.com/blogs/Status/">Home</a></li>


          </ul>
        </nav>

  <p class="license">&copy; Copyright 2016.</p>
  <p class="poweredby">Powered by <a href="http://www.movabletype.org/">Movable Type</a></p>
</div>
          </div>
        </footer>
      </div>
    </div>
    <script src="http://defaria.com/mt/mt-static/jquery/jquery.min.js"></script>
    <script src="http://defaria.com/blogs/Status/mt-theme-scale2.js"></script>
  </body>
</html>
