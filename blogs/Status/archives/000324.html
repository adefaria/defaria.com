<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml" />

   <title>Status for Andrew DeFaria: HybridOS built</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/000323.html" title="LOS178 compares" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/000325.html" title="Hybrid OS" />

   

   

   <script type="text/javascript" src="http://defaria.com/blogs/Status/mt-site.js"></script>
</head>
<body class="layout-one-column" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/000323.html">&laquo; LOS178 compares</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/000325.html">Hybrid OS &raquo;</a>
                     </p>

                     <a id="a000324"></a>
                     <div class="entry" id="entry-324">
                        <h3 class="entry-header">HybridOS built</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Built Hybrid OS for GD and performed binary comparison</li>

  <li>Adding files to CVS on Tomcat</li>

  <li>Completed GD LOS178 Impact Summary</li>

  <li>Resolved long standing issue regarding gnuaout vs. gnu</li>
</ul>
                           </div>
                           <div id="more" class="entry-more">
                              <h2>GD LOS178 Impact Summary</h2>

<h3>Export sources from LOS178</h3>

<p>Export sources from LOS178 CVS tree using the CVS tag REL_LOS178_2p0p0_ppc_FCS. The export will come from the machine named Rock using CVSROOT=:pserver:anoncvs@rock:/cvs/los178-cvs:</p>

<div class="code"><pre>
tomcat:export CVSROOT=:pserver:anoncvs@rock:/cvs/los178-cvs
tomcat:cvs login
Logging in to :pserver:anoncvs@rock:2401/cvs/los178-cvs
CVS password:
tomcat:cvs export -r REL_LOS178_2p0p0_ppc_FCS los178
</pre></div>

<h3>Extract prebuilt CDK</h3>

<p>Extract prebuilt CDK (sunos-xcoff-ppc) binary also using the tag of REL_LOS178_2p0p0_ppc_FCS from Rock. Note that this prebuilt CDK comes from the bin-image section of the CVS repository and that we are only using the ppc.cdksol.tar.gz image:</p>

<div class="code"><pre>
tomcat:cvs export -r REL_LOS178_2p0p0_ppc_FCS bin-image/ppc.cdksol.tar.gz
</pre></div>

<h3>Extract other tools</h3>

<p>The package.sh script from the toolbox area is used to package up the images so we need to extract that too:</p>

<div class="code"><pre>
tomcat:cvs export -r REL_LOS178_2p0p0_ppc_FCS toolbox/package.sh
</pre></div>

<h3>Test Build</h3>

<p>Perform test build.</p>

<div class="note">
Note: Test build requires a symlink from /usr/lynx/3.1.0/ppc/cdk/sunos-xcoff-ppc/bin/bison.simple -> $ENV_PREFIX/cdk/sunos-xcoff-ppc-/bin/bison-simple due to a hard coded path dependency.  This path was not modified due to LOS-178 RSC restrictions
</div>

<p>Steps performed are:</p>

<ol>
  <li>Create ppc_dev area to perform the build in:<br>

<div class="code"><pre>
tomcat:mkdir ppc_dev
</pre></div></li>

  <li>Copy in sources:<br>

<div class="code"><pre>
tomcat:rsync -a los178 ppc_dev
</pre></div></li>

  <li>Unpack CDK into build area<br>

<div class="code"><pre>
tomcat:cd ppc_dev
tomcat:gnutar -zxpf ../bin-image/ppc.cdksol.tar.gz
</pre></div></li>

  <li>Perform build:<br>

<div class="code"><pre>
tomcat:make DEVELOPMENT=yes install > install.log
</pre></div></li>

  <li>Check install.log for errors</li>
</ol>

<h3>Perform binary comparison test</h3>

<p>This binary comparison test is different from the normal binary comparison tests. Basically we are simply extracting all .o's from all .a's in the packaged versions of the product. A little utility script was written to find all .a libraries and copy them to an area (complibs) broken out by the path to the library, then extract all .o's from the .a's. This script is called unpack_libs. It is not intended that such a comparison be performed on a regular basis so this script is more of a one shot script.</p>

<p>Further, a build will create a lot of libraries but not all libraries created will be packaged and shipped. Since we are comparing against a previously built and packaged release we must package up and unpack the build we just performed. This is done using the toolbox/package.sh script as follows:</p>

<ol>
  <li>Package up the image just built:<br>

<div class="code"><pre>
tomcat:toolbox/package.sh ppc_dev dev
</pre></div></li>

    <li>Unpack images to new area:<br>

<div class="code"><pre>
tomcat:mkdir new
tomcat:cd new
tomcat:for tarfile in ../media/*.tar.gz; do
> gnutar -zxpf $tarfile
> done
</pre></div></li>

  <li>Gather all libraries and extract their .o's:<br>

<div class="code"><pre>
tomcat:mkdir complibs
tomcat:../unpack_libs
</pre></div></li>

  <li>Unpack old images (from  t3:/export/scl/los178/2p0p0/FCS/) to old area:<br>

<div class="code"><pre>
tomcat:cd ..
tomcat:mkdir old
tomcat:cd old
tomcat:# copy old tar images here
tomcat:for tarfile in *.tar.gz; do
> gnutar -zxpf $tarfile
> done
</pre></div></li>

  <li>Gather all libraries and extract their .o's:<br>

<div class="code"><pre>
tomcat:mkdir complibs
tomcat:../unpack_libs
</pre></div></li>

  <li>Perform diff<br>

<div class="code"><pre>
tomcat:cd ..
tomcat:diff -r old/complibs new/complibs
</pre></div></li>

  <li>The above will result in 25 .o files being different. Use objdump -D to disassemble these files and compare the disassembled output. No differences detected in disassembled output.</li>
</ol>

<h3>Import sources into new CVS repository</h3>

<p>Sources  will be  imported into the CVS repository using the following command:</p>

<div class="code"><pre>
tomcat:cd los178
tomcat:export CVSROOT=:pserver:adefaria@tomcat:/cvs/hybrid-os-cvs
tomcat:cvs login
Logging in to :pserver:adefaria@tomcat:2401/cvs/hybrid-os-cvs
CVS password:
tomcat:# First add all directories
tomcat:find . ! -name CVS -type d -exec cvs add -m "HybridOS import from LOS178" {} \;
tomcat:# Now add all files
tomcat:find . -type f -exec cvs add -m "HybridOS import from LOS178" {} \;
tomcat:cvs commit
</pre></div>

<p>Additionally the binary CDK image was checked into binary-image:</p>

<div class="code"><pre>
tomcat:cd ../bin-image
tomcat:cvs add -m "HybridOS import from LOS178" ppc.cdksol.tar.gz
tomcat:cvs commit
</pre></div>

<p>Finally the toolbox/package.sh script as checked into toolbox:</p>

<div class="code"><pre>
tomcat:cd ../toolbox
tomcat:cvs add -m "HybridOS import from LOS178" package.sh
tomcat:cvs commit
</pre></div>

<h3>Tag initial sources with the tag REL_HYBRIDOS_1p0_ppc_20050328</h3>

<p>All sources, bin packages and toolbox scripts are then tagged:</p>

<div class="code"><pre>
tomcat:cvs tag REL_HYBRIDOS_1p0_ppc_20050328 los178 bin-image toolbox
</pre></div>

<h3>Check out all sources and prebuilt CDK and perform build procedure again</h3>

<p>Next we check out all sources, bin-image and toolbox scripts into new fresh areas and then perform the build procedure as described above.</p>

<h3>Following successful build perform binary comparison test again</h3>

<p>Perform the binary comparison described above again.</p>

<h3>Package build to archive area</h3>

<p>Use the package script to package up the images and place in the archive area at tomcat:/export/dev_archive/hybridos/1p0/20050328/solaris/media/ppc</p>

<h2>Long standing issue regarding gnuaout vs. gnu</h2>

<p>This has been bugging me for a while and I finally tracked it down. Often I'd build a toolchain then attempt to build LynxOS and it would fail when attempting to get the compiler. It seems that the toolchain build was packing up the compiler tar image with one name and the build scripts were using another name to try to find it. This resulted in errors. Now I had gotten around this via a symlink but I've been wanting to make the two build procedures agree on the names of things...</p>

<p>As Adam writes here the preferred name for the toolchain tar image is derived from config.guess:</p>

<blockquote type=cite>
<p>Andrew DeFaria writes:</p>

  <blockquote type=cite>
  <p>toolchain-i686-pc-linux-gnu-i386.tar.gz</p>
  </blockquote>

<p>This. But I think we get this from config.guess so try to see how this nice level of abstraction fails before you hard-code something.</p>
</blockquote>

<p>The "toolchain-" portion is standard for the toolchain. The "i686-pc-linux-gnu" portion comes out of config.guess:</p>

<div class="code"><pre>
[int@dopey 20050207]$ /export/build1/LYNXOS_500/work_area/toolchain/3.2.2/toolchain/src/config.guess
    i686-pc-linux-gnu
</pre></div>

<p>However the int_tools uses the following code to determine the name of the toolchain tar image:</p>

<div class="code"><pre>
proc Unload_com { platform dir comp_release format host } {

  switch "$host" {
    <font color="red"><b>"linux"  { set host_platform "i686-pc-linux-<u>gnuaout</u>" }</b></font>
    "win32"  { set host_platform "i686-pc-cygwin" }
    "sunos"  { set host_platform "sparc-sun-solaris2.7" }
    "lynxos" { if { "$platform" == "x86" } {
                   set host_platform "i386-lynx-lynxos"
               }
               if { "$platform" == "ppc" } {
                     set host_platform "powerpc-lynx-lynxos"
               }
             }
  }
  if { "$platform" == "x86" } {
        set target_platform "i386"
  } else {
        set target_platform "$platform"
  }
  set COMPILER_TAR_GZ "toolchain-$host_platform-$target_platform.tar.gz"
</pre></div>

<p>The highlighted portion above is the line in error and the underlined portion should change to simply "gnu". The int_tools do not have the benefit of being able to call config.guess so this could likely break in the future again.</p>

<p>I will perform this change, along with other int_tool changes required for the new tag labeling under and ECR.</p>

                           </div>
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">Posted by  on March 28, 2005  6:30 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000324.html">Permalink</a>
                        </p>
                     </div>

                     

                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
