<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml" />

   <title>Status for Andrew DeFaria: Building CDK on Windows</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/000378.html" title="Built LOS178 2.1.0 TOB" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/000380.html" title="Test build of LOS178 2.1.0" />

   

   

   <script type="text/javascript" src="http://defaria.com/blogs/Status/mt-site.js"></script>
</head>
<body class="layout-one-column" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/000378.html">&laquo; Built LOS178 2.1.0 TOB</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/000380.html">Test build of LOS178 2.1.0 &raquo;</a>
                     </p>

                     <a id="a000379"></a>
                     <div class="entry" id="entry-379">
                        <h3 class="entry-header">Building CDK on Windows</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Investigated bug on Windows nmake of CDK</li>

  <li>Fixed build_los178 to properly build LOS178 2.1</li>
</ul>
                           </div>
                           <div id="more" class="entry-more">
                              <h3>Windows nmake bug for CDK build</h3>

<p>There is still something wrong. Here's what I did:</p>

<ul>
  <li>Obtained the following tarballs from the 20050628 archive:
    <ul>
      <li>2000-00.los178_rsc_src.tar.gz</li>

      <li>2001-00.los178_src.tar.gz</li>

      <li>2013-00.los178_dev.tar.gz</li>

      <li>2015-00.los178_rsc_dev.tar.gz</li>
    </ul>
  <li>Unpacked those tarballs + ppc.cdkwin32.tar.gz into /tmp/los178</li>

  <li>Setup my environment properly (this includes VCVARS32.bat)</li>

  <li>cd'ed to src/cdk and performed make install > install.log 2>&1</li>
</ul>

<p>I still have the error:</p>

<div class="code"><pre>
    Compiling coff.o
    coff.c(87) : fatal error C1083: Cannot open include file: 'family/ppc/arch_mem.h': No such file or directory
    NMAKE : fatal error U1077: 'cl.exe' : return code '0x2'
    Stop.
    make[1]: *** [WIN32_VS_UTIL] Error 2
</pre></div>

<p>It seems clear to me that the compiler cannot locate the include file family/ppc/arch_mem.h which does reside under $ENV_PREFIX/sys/include. Additionally it's clear that common/mkimage/Makefile was changed to append "-I$(ENV_PREFIX)/sys/include" to SPECIAL_CFLAGS to resolve this issue. However something on Windows (and Windows nmake) is causing this to remain a problem.</p>

<p>It seems that nmake eventually issues the following command to compile coff.c -> coff.o:</p>

<div class="code"><pre>
    cl.exe /nologo /ML /W3 /GX /D "_WIN32_VS" /D "_CONSOLE" /D "WIN32" /D "_MBCS" /FD /c -c coff.c -D__powerpc__ /Fo"coff.o"
</pre></div>

<p>Which, of course, doesn't seem to mention $ENV_PREFIX/sys/include at all. IOW the above results in:</p>

<div class="code"><pre>
    cl.exe /nologo /ML /W3 /GX /D "_WIN32_VS" /D "_CONSOLE" /D "WIN32" /D "_MBCS" /FD /c -c coff.c -D__powerpc__ /Fo"coff.o"
    coff.c
    coff.c(87) : fatal error C1083: Cannot open include file: 'family/ppc/arch_mem.h': No such file or directory
</pre></div>

<p>While the following results in a successful compilation (with warnings):</p>

<div class="code"><pre>
    cl.exe /nologo /ML /W3 /GX /D "_WIN32_VS" /D "_CONSOLE" /D "WIN32" /D "_MBCS" /FD /c -c coff.c -D__powerpc__ /Fo"coff.o" /I$ENV_PREFIX/sys/include
</pre></div>

<p>The Makefile and Windows nmake are not arranging for SPECIAL_CFLAGS to be passed along to the compiler.</p>

<h3>Fix to build_los178</h3>

<p>The build_los178 script was having a problem building LOS178. It would fail in different ways than when done from the command line. I suspected the problem would be in the setup_bash function as it attempts to reproduce what a ". SETUP.bash" does inside the Perl environment. Turns out I was right. Changed that subroutine to properly set HOST_OS_REVISION (previously it had an extra carriage return from `uname -r`) and to add /usr/ucb to the PATH.</p>
                           </div>
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">Posted by  on June 30, 2005 10:21 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000379.html">Permalink</a>
                        </p>
                     </div>

                     

                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
