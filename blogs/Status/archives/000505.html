<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml" />

   <title>Status for Andrew DeFaria: log_activity/create_dev_snapview.pl</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/000504.html" title="log_checkins" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/000506.html" title="Clearcase Modules/log_activity" />

   

   

   <script type="text/javascript" src="http://defaria.com/blogs/Status/mt-site.js"></script>
</head>
<body class="layout-one-column" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/000504.html">&laquo; log_checkins</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/000506.html">Clearcase Modules/log_activity &raquo;</a>
                     </p>

                     <a id="a000505"></a>
                     <div class="entry" id="entry-505">
                        <h3 class="entry-header">log_activity/create_dev_snapview.pl</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked on log_activity Perl script</li>

  <li>Investigated issue with R/O components for create_dev_snapview.pl</li>
</ul>
                           </div>
                           <div id="more" class="entry-more">
                              <h2>log_activity</h2>

<p>Ray Tran wrote:</p>

<blockquote type=cite>
  <p>To summarize the three logging projects. The primary log directory is /projects/scm_tools_logs in San Jose. Please let me know if you have any input or suggestions</p>
</blockquote>

<p><b>We need a global area that's truly global!</b></p>

<p>Turns out that /projects/scm_tools_logs doesn't exist. I assume you meant /projects/IT_SCM/logs. However /projects/IT_SCM doesn't exist on either ccase-rmna-3 nor ccase-sj1-1... So running a script that requires Clearcase such as this I cannot access the directory where I need to deposit the log files! Additionally I cannot access /projects/IT_SCM/SCM/lib for my libraries nor /projects/IT_SCM/SCM/cc where the script would be residing...</p>

<blockquote type=cite>
<dl>
  <dt>Activity logs</dt>
    <dd><p>This is a log of who checked things out and into ClearCase and from what view. I think we can do this hourly and append to the log file so it doesn't take too long to run.</p></dd>
</dl>
</blockquote>

<p>Turns out lshistory is pretty flexible and efficient. One does not need to do a cleartool find on all elements and then call lshistory on individual elements, etc. The lshistory command supports a -recursive parameter. But we really want to report things across vobs. The lshistory command also supports a -avobs parameter. Two limitations here... First lshistory needs to work the context of a view. Secondly, -avobs only works on vobs that are mounted.</p>

<p>I've coded up a script called log_checkins which will create a view (named default &lt;- I can change this) if necessary and also mounts all vobs prior to calling lshistory. It also supports a -n parameter for number of days - thus -n 7 will produce a weeks worth of log files. Logfiles are named checkin.&lt;<i>date</i>&gt;.log where &lt;<i>date</i>&gt; is the date in YYYYMMDD format. So -n 1 (or not specifying -n) will produce a log file for the previous day (e.g. checkin.20051227.log) encompassing all activity on that day, while specifying -n 7 will produce 7 logfiles, one for each of the last 7 days properly dated.</p>

<p>The fields in the logfile (separated with ";") are:</p>

<ol>
  <li>&lt;<i>date</i>&gt;.&lt;<i>time</i>&gt; (&lt;<i>date</i>&gt; is YYYYMMDD
and &lt;<i>time</i>&gt; is HHMMSS 24 hour format). This format makes the logfile easily sortable by date and time with sort(1).</li>

  <li>&lt;<i>username</i>&gt; (Not sure where lshistory gets the username, normally is the same as the next field but sometimes it's different - e.g. "Clear Case Administrator")</li>

  <li>&lt;<i>user</i>&gt;@&lt;<i>host</i>&gt; The user login name (e.g. adefaria) @ host (e.g. ltsjca-adefaria)</li>

  <li>&lt;<i>event</i>&gt; The Clearcase event</li>

  <li>&lt;<i>element</i>&gt; View extended path name</li>
</ol>

<h3>Clearcase Events</h3>

<p>I ran log_checkins for the last 30 days and examined the log files. No filtering for only "check in" events were done. The range of Clearcase events are:</p>

<ul>
  <li>checkout directory version</li>

  <li>checkout version</li>

  <li>create activity</li>

  <li>create baseline</li>

  <li>create branch</li>

  <li>create branch type</li>

  <li>create directory element</li>

  <li>create directory version</li>

  <li>create file element</li>

  <li>create hyperlink</li>

  <li>create label type</li>

  <li>create trigger type</li>

  <li>create version</li>

  <li>destroy activity in versioned object base</li>

  <li>destroy checkpoint "&lt;<i>checkpoint</i>&gt;" in versioned object base</li>

  <li>destroy element in versioned object base</li>

  <li>destroy hyperlink "&lt;<i>hyperlink</i>&gt; in versioned object base</li>

  <li>destroy sub-branch "&lt;<i>sub-branch</i>&gt;" of branch</li>

  <li>destroy type in versioned object base</li>

  <li>destroy version on branch</li>

  <li>import file element</li>

  <li>import hyperlink</li>

  <li>lock activity</li>

  <li>lock branch</li>

  <li>lock branch type</li>

  <li>lock trigger type</li>

  <li>lock versioned object base</li>

  <li>unlock activity</li>

  <li>unlock versioned object base</li>
</ul>

<p>There are probably other event types. Also, in most cases the &lt;<i>element</i>&gt;
field contains additional information that can be extracted. For example:</p>

<div class="code"><pre>
20051201.151257;drambo;drambo@PCRMNA-DRAMBO;create
version;/vobs/OnePhone/pub/Makefile@@/main/OnePhone_mainline_Intr/OnePhone_3.2_Intr_new/10
</pre></div>

<p>one can see that this was a creation of a version in the OnePhone
vob of pub/Makefile. The part after the @@ is the branch information
(/main/OnePhone_mainline_Intr/OnePhone_3.2_Intr_new) and version 10.</p>

<p>Although you asked for checked out things, checked in things are more interesting. In fact I'd say that all of the above Clearcase events are interesting and that we should just log all of it (and I'll change log_checkins -&gt; log_activity and change checkin.&lt;<i>date</i>&gt;.log
-&gt; activity.&lt;<i>date</i>&gt;.log</p>

<blockquote type=cite>
  <dt>Pulse check log</dt>
    <dd><p>This is a script that should run a quick checkout and time the process. This should run at least every 15 minutes. I'm not sure if we need to set this up for each VOB or if we can just create a IT_SCM VOB and checkout from there. We then control how much data gets moved. For example in Perforce, I've created some file that are 100MB in size. I total the files and check this out. I now have control over the data.</p></dd>
 
  <dt>Statistic logs</dt>
    <dd><p>This is a script that would create two logs - one general data for each site, one for each VOB of each site.</p>
 
    <p>The general data should have at the least - date_time;site;number of VOBs; number of total VOB size; number of snapshot views; number of dynamic views; number of file elements; number of directory element;...</p>
 
    <p>The VOB specific data - date_time;site;VOB_name;size of database;size of source pool; size of devired object; size of cleartext; size of admin data</p></dd>
</dl>
 
    <p>The directory structure that I envisioned is as such</p>
 
<div class="code"><pre>
/projects/scm_tools_logs
 
 - cc
      - 2005
          - 12
             - 01
 </pre></div>
</blockquote>

<p>I see little benefit in constructing such a directory structure, especially programmatically. Instead I place the YYYYMMDD in the file name of the log file in a format described above. This format is easily parseable, sortable and grepable and it also compresses nicely. A directory structure such as above could easily be created at a later time or sets of logfiles could be easily gzipped and tar'ed (e.g. mkdir 2005; tar -zcf 2005/activity.logs.gz activity.2005*; rm activity.2005*).</p>

<h2>R/O Components & create_dev_snapview.pl</h2>

<p>After speaking at length with Shivdutt about this and learning more about UCM, projects, streams and the like I see a problem here. Let me explain it based on how I see this...</p>

<p>With UCM you have projects which contain components which can be R/W or R/O. Projects also have streams, one integration stream (and an associated integration view) and one or more development streams (and their associated development views).</p>

<p>When a development view is created in a development stream it is populated with all of the components in the project based on baselines. The difference here is that you can use different baselines for the various R/W components but you cannot use different baselines for the R/O components. The baseline information for R/O components is kept "globally" at the project level and is not modifiable in the development streams. Since, theoretically, R/O components are not modifiable they considered shared for all development streams.</p>

<p>While R/O components can have their baselines changed (usually advanced) at the project level, the act of doing so affects all development streams (dynamic development streams will be affected immediately while snapshot development views at next update time).</p>

<p>So if we had create_dev_snapview.pl alter the baselines of the R/O components by retarding (or advancing) them, then the side effect would affect other developers. We don't want that!</p>

<p>The only way to handle this would be to create a new project where the R/O components could be set to a previous set. This would be much more intensive and could easily be come unwieldy. For example, if you wanted 3 days worth of "history" we would need to create 3 projects to contain them.</p>
                           </div>
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">Posted by  on December 28, 2005 12:59 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000505.html">Permalink</a>
                        </p>
                     </div>

                     

                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
