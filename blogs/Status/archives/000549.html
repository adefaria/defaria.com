<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml" />

   <title>Status for Andrew DeFaria: Migration Plan</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/000548.html" title="Building salira2" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/000550.html" title="trlock" />

   

   

   <script type="text/javascript" src="http://defaria.com/blogs/Status/mt-site.js"></script>
</head>
<body class="layout-one-column" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/000548.html">&laquo; Building salira2</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/000550.html">trlock &raquo;</a>
                     </p>

                     <a id="a000549"></a>
                     <div class="entry" id="entry-549">
                        <h3 class="entry-header">Migration Plan</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>I feel we've reached a time where we can migrate users over to the new system. I've worked out how to migrate the CQ database, build issues for both the old (salira) and new (salira2) vobs, multisiting is working, by and large scripts work as well as CQD. The following is a plan for migrating Salira to the new server. Please let me know your comments and concerns.</p>

<p><b>Time Spent:</b> 2 hours</p>
                           </div>
                           <div id="more" class="entry-more">
                              <h2>1.0 Migrating Clearquest</h2>

<p>This migration is a little more critical because not only does the database need to be remigrated since bugs have probably been added since my test migration but clients must also update to the latest version of Clearquest in order to access the new database. Also, CQD (or rather CQD clients) need to ask the new server for information. Luckily the later involves a simply change to a library however timing remains important. This has to be done in one swoop.</p>

<p>The following needs to take place:</p>

<ol>
  <li>Shutdown access to the database on sons-clearcase</li>
  <li>Backup the database</li>
  <li>Use installutil to copy the user db to the new server. <br>
  </li>
  <li>Export and import user accounts (since you've made changes)</li>
  <li>Convert the database to SQL Anywhere 8.0 format</li>
  <li>Test new database</li>
  <li>Switch cqc.pm library to default to new server</li>
  <li>Have client upgrade to the new Clearquest</li>
</ol>

<p>I suspect that the database conversion will take at most 4 hours so doing this on say Saturday or Sunday might be a good idea. As for desktop installations the users should be able to simply type "upgrade clearquest" in a Cygwin window. It will prompt the user to proceed then
it will uninstall the old Clearquest, install the new Clearquest and reboot the users desktop. The user will then need to import a Clearquest connection profile and they should be set.</p>

<p>Bear in mind that is anything goes wrong the users should be able to use the CQWeb interface by pointing to <a href="http://sons-sc-cc/cqweb/login">http://sons-sc-cc/cqweb/login</a>. China users will need to be made aware of the new server location in the URL but should otherwise be unaffected as I doubt that China users use the Clearquest client directly (way too slow!).</p>

<h2>2.0 Migrating Clearcase</h2>

<p>In general users need to stop using views that are sons-clearcase oriented. By that I mean they need to start checking in their work and generally getting their views to the state where they can remove them. Then they need to switch-&lt;server&gt; to sons-sc-cc and create new views there. As we are currently multisiting between sons-clearcase and sons-sc-cc they can migrate at their leisure however bear in mind that sons-clearcase should be going away. See also <i>Mastership Issues</i> below.</p>

<p>Users don't necessarily need to upgrade their Clearcase software as the old software will work with the new server, however you should urge them to do so. Again I plan on updating the upgrade command to likewise allow desktop users to simply type "upgrade clearcase".</p>

<p>One thing that users should do is change the symlink for /etc/site_parms from /view/official/Tools/adm/etc/site_parms.US to /view/official/Tools/adm/etc/site_parms.SC. Most of my scripts rely on this site_parms file to set environment variables to describe particulars about the site. This can be done with the following:</p>

<div class="code"><pre>
$ rm /etc/site_parms
$ ln -s /view/official/Tools/adm/etc/site_arms.SC /etc/site_parms
</pre></div>

<h2>3.0 Decommissioning sons-clearcase</h2>

<p>Sons-clearcase has served you many years as the hub of both Clearcase/Clearquest services as well as a build machine. It has performed many duties and has done them well. Decommissioning such a server so near and dear to Salira's heart will take some doing, some
finesse. The overriding concern is to untangle sons-clearcase from day to day operations and assign those duties over to sons-sc-cc in a proper manner before decommissioning  sons-clearcase. Than have a nice going away party!</p>

<p>As users migrate to using the new server and once all elements are checked in and views are no longer needed they should be removed. We need to get to a place where all Clearcase activity on sons-clearcase is stopped, checked in and removed.</p>

<p>There are some ancillary functions that sons-clearcase is still performing that you may be unaware of such as licensing. These too will need to be transfered to the new server.</p>

<p>Finally sons-clearcase can be powered down and if there are any things we've missed it could be easily powered back up if need be.</p>

<h3>3.1 Lock issues</h3>

<p>One thing that is not multisited is locks on label/branch/etc types. Salira relies on these logs. I will need to write a script to evaluate the locks in the vobs on sons-clearcase and to issue the same locks on sons-sc-cc. I will work on this this week.</p>

<h3>3.2 Mastership Issues</h3>

<p>With multisited vobs comes issues of mastership. As you know a branch can only be mastered by one replica. The current vobs' main branch is mastered on sons-clearcase as are branches such as REL_1.0, etc. Mastership should be transfered to sons-sc-cc before sons-clearcase gets decommissioned.</p>

<p>There is a command called chmaster that luckily has a -all option to change the mastership of all objects to the new server. But it wants to have everything checked in and nothing locked.</p>

<h3>3.3 Replica removal</h3>

<p>With the vobs replicated to sons-sc-cc and all Clearcase views removed and mastership moved to sons-sc-cc, the final act would be to remove the US replica of the vobs from the vob family. This way sons-sc-cc and sons-cc in China would no longer attempt to update the US replicate on sons-clearcase (The replica on sons-sc-cc is called the SantaClara replica and remains in the vob family hosted by sons-sc-cc).</p>

<h2>4.0 License Issues</h2>

<p>Sons-clearcase also served as a license server for both Clearcase and Clearquest. Salira will need to contact IBM/Rational in order to obtain new licenses for these as they are host based. This can be delayed however it will need to be done before sons-clearcase can be decommissioned.</p>

<h2>5.0 Miscellaneous Issues</h2>

<p>There are several scripts which use some magic to determine where to find Perl library code (here or in China). That magic hard codes sons-clearcase as the server here to use. That'll need to change to use sons-sc-cc before a complete shutdown of sons-clearcase is doable.</p>
                           </div>
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">Posted by  on May  2, 2006  2:42 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000549.html">Permalink</a>
                        </p>
                     </div>

                     

                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
