<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml" />

   <title>Status for Andrew DeFaria: PerlDB Tips</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/000581.html" title="gpdb_add_project.pl using gpdb user and Nice" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/000583.html" title="The Oracle speaks..." />

   

   

   <script type="text/javascript" src="http://defaria.com/blogs/Status/mt-site.js"></script>
</head>
<body class="layout-one-column" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/000581.html">&laquo; gpdb_add_project.pl using gpdb user and Nice</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/000583.html">The Oracle speaks... &raquo;</a>
                     </p>

                     <a id="a000582"></a>
                     <div class="entry" id="entry-582">
                        <h3 class="entry-header">PerlDB Tips</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>The Perl debugger is one of those valuable tools that surprisingly it seems few Perl coders know well. Here are some quick tips on using the Perl debugger. First a few explanations about commands I tend to use:

<blockquote>
<dl>
  <dt>s</dt>

  <dd>Single step. Step to the next statement stepping into any subroutines (where the source file is known and accessible).</dd>

  <dt>n</dl>

  <dd>Step over - if the line contains a call to a subroutine then this will step over that subroutine.</dd>

  <dt>r</dt>

  <dd>Return from subroutine - if, say you accidentally stepped into a subroutine or if you just want to return,</dd>

  <dt>R</dt>

  <dd>Rerun - start your Perl script again in the debugger with all the parms you started with.</dd>

  <dt>q</dt>

  <dd>quit</dd>

  <dt>p &lt;variable or expression&gt;</dt>

  <dd>Will print the contents of a variable or expression. Expressions can be Perl expressions including calls to subroutines. You can, for example, do "p 'There are " . scalar @foo . ' lines in foo';</dd>

  <dt>x &lt;variable or expression&gt;</dt>

  <dd>Like p above however p will simply print out HASH for hashes whereas x will format them out. Also x will print out "undef" for things that are undefined yet p will print nothing for them.</dd>

  <dt>l (ell)</dt>

  <dd>List the next windowSize lines (see below). Use "l &lt;n&gt;"  where &lt;n&gt; = a line number to list that line.</dd>

  <dt>v &lt;n&gt;</dt>

  <dd>View lines around &lt;n&gt;</dd>

  <dt>V &lt;package&gt;</dt>

  <dd>List exported subroutines and variables for &lt;package&gt; (e.g. V MyModule will is all stuff exported from MyModule).</dd>

  <dt>f &lt;filename&gt;</dt>

   <dd>File - switch to another file. (e.g. f MyModule) and the debugger switches to viewing MyModule.pm.</dd>

  <dt>c &lt;n&gt;</dt>

  <dd>Continue to line &lt;n&gt;. If n is not specified then just continue until the next break point or the end of the script. Continue is like setting a temporary break point that disappears when you hit the line.</dd>

  <dt>b &lt;n&gt; &lt;condition&gt;</dt>

  <dd>Breakpoint - set a break point (or b &lt;n&gt; $name eq "Donna" which will break at line &lt;n&gt; iff $name is "Donna" (evaluated when the debugger gets to line &lt;n&gt;))
</dl>
</blockquote>

<p>Also, at the Perl db prompt you can type in any Perl. So, for example, I often work out regex's that way. I'll be debugging a Perl script and stepping up to something like:</p>

<div class=code><pre>
     10==> if (/(\d*).*\s+/) {
     11      print "match!\n";
     12      $x = $1;
     13    }
</pre></div>

<p>Then I'll type in stuff like:</p>

<div class=code><pre>
     DB<10> if (/(\d*).*\s+/) { print "1 = $1\n"; } else { print "No
     match!\n"; }
     No match!
     DB<11>
</pre></div>

<p>Then I can use the command history (with set -o emacs at the shell before executing perl db emacs key bindings work for me) to edit and enter that perl if statement changing the regex until it works correctly. This way I know I got the right regex. Copy and paste the new, tested, regex from the debugging session into my code then "R" to reload the debugger.</p>

<p>Or you can say call an arbitrary subroutine in your script:</p>

<div class=code><pre>
       DB<2> b Rexec::ssh
       DB<3> p Rexec::ssh
Rexec::ssh(/view/cmdt_x0062320/vobs/cmtools/src/misc/GPDB/bin/../../../../lib/perl/Rexec.pm:60):
     60:         my $self = shift;
       DB<<4>>
</pre></div>

<p>The "p Rexec::ssh" says to print the results of the following expression. The expression is a function call in to the Rexec module for the subroutine ssh. Since we just set a break point there in the previous debug command we break at the start of that subroutine and can then debug it. Note you don't want to "c Rexec::ssh" because that would continue the actual execution of your script and only stop at Rexec::ssh if that routine was actually called. Viola, you just forcefully caused the Perl interpreter to branch to this routine!</p>

<p>Another thing I'll frequently do is set or change variables to see how the code would proceed <b>if</b> the variables were correct (or perhaps incorrect to test error conditions). So let's say a forced execution of the subroutine Log like the above:

<div class=code><pre>
42      sub Log {
43:==>    my $msg = shift;
44        print "$msg\n";

  DB<23> s
main::Log(EvilTwin.pl:45):       print "$msg\n";
  DB<24>$msg = "Now I set msg to something I want it to be"
  DB<25>s
Now I set msg to something I want it to be
main::Log(EvilTwin.pl:47):              return;
  DB<25>
</pre></div>

<p>There are all sorts of good reasons to examine (p $variable) and set ($variable = "new value") variables during debugging.</p>

<p>Finally put the following into ~/.perldb:</p>

<div class=code><pre>
     parse_options ("windowSize=23");
</pre></div>

<p>This sets the window size to 23 so that 'l" lists the next 23 lines.</p>
                           </div>
                           <div id="more" class="entry-more">
                              
                           </div>
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">Posted by  on October 17, 2006  8:41 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000582.html">Permalink</a>
                        </p>
                     </div>

                     

                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
