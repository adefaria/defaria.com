<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: November 2005 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/2005_10.html" title="October 2005" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/2005_12.html" title="December 2005" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/2005_10.html">&laquo; October 2005</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/2005_12.html">December 2005 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">November 30, 2005</h2>
                     <a id="a000487"></a>
                     <div class="entry" id="entry-487">
                        <h3 class="entry-header">Stgloc/Code Page</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Tried to figure out why -stgloc is not working in Richmond nor why I can't seem to create a view in a share that is in an area where .stgloc exists</li>

  <li>Worked with Vin Ton and Rob Swindell regarding a problem with CQ Web and Code Pages</li>

  <li>Worked on other code page issues</li>

  <li>Added CharacterSetValidation package to PQA</li>
</ul>
                              
                              <h2>Stgloc problems</h2>

<p>Why does the following happen:</p>

<div class="code"><pre>
Local:mkdir \\\\fs-rmna-01\\<span>viewstoreQA</span>\\adefaria_test
Local:rmdir \\\\fs-rmna-01\\<span>viewstoreQA</span>\\adefaria_test
Local:ct mkview -tag adefaria_test \\\\fs-rmna-01\\viewstoreQA\adefaria_test
cleartool: Error: Attempt to get location information on "\\fs-rmna-01\viewstoreQA\adefaria_test"
failed: Invalid argument.
Local:ct mkview -tag adefaria_test \\\\ltsjca-adefaria\\views\\adefaria_test
Created view.
Host-local path: ltsjca-adefaria:C:\Views\adefaria_test
Global path:&nbsp;&nbsp;&nbsp;&nbsp; \\ltsjca-adefaria\views\adefaria_test
</pre></div>

<p>I suspect that the problem is that this area is on a filer so Clearcase cannot determine where the view_server process should run. I believe that the only way Clearcase can figure out which server should serve the view_server process for this area is via the stgloc and that the stgloc for this area is not properly configured. Attempting to create views either through the command liine or the GUI using -stgloc viewstore or viewstoreQA also fail.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  4:48 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000487.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 29, 2005</h2>
                     <a id="a000486"></a>
                     <div class="entry" id="entry-486">
                        <h3 class="entry-header">create_dev_snapview</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Updated create_dev_snapview to support -tag, -dir and -load_rules.</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:10 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000486.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 28, 2005</h2>
                     <a id="a000485"></a>
                     <div class="entry" id="entry-485">
                        <h3 class="entry-header">bin_merge/create_snapshot_view/PQA</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Investigating issues with bin_merge</li>

  <li>Discussed with Andrew about extending script to create snapshot views</li>

  <li>Worked with two people who have had issues with accessing new PQA Clearquest database</li>
</ul>
                              
                              <h2>bin_merge</h2>

<p>Spoke with Shivdutt about this. We decided that bin_merge should copy the binary file from the branch to the current view's checkedout copy and draw a merge arrow. Also, it should just draw an merge arrow if the user elects to use the from branch version. This mimicks a parent/child relationship that is assumed here</p>

<p>Still need to look into the Rebase to parent operation.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:02 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000485.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 23, 2005</h2>
                     <a id="a000484"></a>
                     <div class="entry" id="entry-484">
                        <h3 class="entry-header">Forking in PerlTk</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Continued to help several users with connecting to the new Controller Clearquest Database for Vinh's users</li>

  <li>Added Version Tree button to the bin_merge prompt dialog box.</li>

  <li>Resolved problem with forking from PerlTk</li>
</ul>
                              
                              <h2>Forking in PerlTk</h2>

<p>The issue here is that calling fork(2) in general on Windows just doesn't work well. Clearcase's Perl is based on ActiveState Perl and ActiveState Perl is not the best implementation of Perl. Cygwin's Perl is by far a much better implementation but Cygwin's Perl works from a true Posix environment which is specifically what Cygwin is all about. However Cygwin's Perl does not support PerlTk (I posted on Cygwin's mailing list about this - it would be great if Cygwin would finally support PerlTk) and Cygwin would need to be present on all Windows systems.</p>

<p>In general, while fork(2) does work under ActiveState is does not work if you have Tk objects created. Chris had suggested to use "start &lt;program&gt;" which is fine - for Windows - but would fail in Unix. I like to wrote my code such that it works on both Windows and Unix. So I tried in vain to get fork to work. However, ActiveState's fork(2) call is horribly broken so I had to code around it like this:</p>

<div class="code"><pre>
sub VersionTree {
  my $file = shift;

  my $cmd =  "cleartool lsvtree -graphical $file";

  if ($^O =~ /mswin|cygwin/i) {
    system "start /b $cmd";
  } else {
    my $pid = fork;

    return if $pid;

    system $cmd;
    exit;
  } # if
} # VersionTree
</pre></div>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  1:59 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000484.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 21, 2005</h2>
                     <a id="a000483"></a>
                     <div class="entry" id="entry-483">
                        <h3 class="entry-header">Remaining PQA Issues/GNATS stripmime</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked with Vinh's group and adjusting to life with the new Controller CQ Database. Wrote instructions for how to unsubscribe to some Broadcom email distribution lists</li>

  <li>Documented how to install the new Clearquest Client Software</li>

  <li>Coded stripmime filter for GNATS.</li>
</ul>
                              
                              <h2>Stripmime</h2>

<p>The script described above basically takes as input an email message. It then extracts the header portion and the body portion. It uses some CPAN modules (MIME::Base64 and MIME::Tools as well as MIME::Parser) to analyze the message and obtain the message "parts". Some transformations are performed on the header information and then it is written to stdout. For the plaintext part (if present) it will again write out the message to stdout Other, non-textual parts (AKA attachments) are written to a subdirectory based on the message name/number and a note is included to stdout indicating were to find the attachment.</p>

<p>The stripemime script placed in /tools/gnats/4.0/bin does the same thing except that attachments are disregarded and no mention of them are written to stdout. However there is an implicit assumption above that there does exist at least one plaintext version of the mail message. This need not be the case. I know, for example, when using Thunderbird I have the option of sending email as HTML, plain text or both. I tend to send both, which are  epresented in the raw email as MIME multipart with the first part being a plaintext version of the HTML, which is sent as the second multipart as HTML. However, if I were to select HTML Only I would not get the plaintext part.  Stripemime, as currently coded would generate a blank email message.</p>

<p>Also, on gnats-irva-3, could my shell be set to bash? I've tried to set it but I get permission denied. Also, I don't appear to have a home directory set to /home/adefaria for the gadefaria user?</p>

<p>Finally, MIME::Parser is not installed on gnats-irva-3:</p>

<div class="code"><pre>
gnats4@gnats-irva-3[+1035] bin/stripmime
Can't locate MIME/Parser.pm in @INC (@INC contains:
/tools/perl/5.004_04/SunOS/lib/sun4-solaris/5.00404
/tools/perl/5.004_04/SunOS/lib
/tools/perl/5.004_04/SunOS/lib/site_perl/sun4-solaris
/tools/perl/5.004_04/SunOS/lib/site_perl .) at bin/stripmime line 47.
BEGIN failed--compilation aborted at bin/stripmime line 47.
</pre></div>

<p>I had managed to install MIME::Parser on my Cygwin system using "perl
-MCPAN -e 'install MIME::Parser'"</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:38 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000483.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 19, 2005</h2>
                     <a id="a000482"></a>
                     <div class="entry" id="entry-482">
                        <h3 class="entry-header">PQA Merge (Part II)</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked with Vinh on small problem with Gating_Item_SW.</li>

  <li>Backed up database to \\p4test\Cont as CQ_Controller_Prod.db.backup</li>

  <li>Copied backup up to \\pcirvd-dshah\CQ</li>
</ul>
                              
                              <h2>Gating_Item_SW</h2>

<p>Vinh noticed an abnormality whereby some Gating_Item_SW items were not correctly transfered. I'm not sure how pqamerge messed this up as it never changes the value of the data, just the field name. We can look at this later, after the merge is completed. Meantime VInh use his SQL prowness to fix the problem.</p>


                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  2:47 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000482.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 18, 2005</h2>
                     <a id="a000481"></a>
                     <div class="entry" id="entry-481">
                        <h3 class="entry-header">PQA Merge</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>This blog entry is to track the PQA merge process. See extended entry for full details...</p>
                              
                              <ul>
  <li>Received backups from Dave Shah</li>

  <li>In Clearquest designer I did Database: Delete Database for Cont and ContT</li>

  <li>In Enterprise Manager:</li>

  <ul>
    <li>Deleted 5 databases: CQ_Controller_Test, CQ_Controller_Prod, CQSchema03, CQ_TO_Prod and CQ2001AProd</li>

    <li>Created those 5 databases anew</li>

    <li>Restored CQSchema03, CQ_TO_Prod and CQ2001AProd</li>

    <li>Changed server field in CQSchema02: master_dbs from production server to p4test</li>

    <li>Ran SIDMap on all 5 databases</li>

    <li>Made sure that the user CQ03_Admin was added to CQSchema03, CQ_Controller_Test and CQ_Controller_Prod as a DB owner</li>
  </ul>

  <li>Back in Clearquest Designer I found that Cont and ContT were not deleted in the newly restored schema so I deleted ContT</li>

  <li>Next I created a new database for ContT</li>

  <li>Tried to delete Cont but received an error: Invalid object name "dbglobal". Worked around this problem but setting is_deleted to 1 using Enterprise Manager</li>

  <li>Created new Cont database</li>

  <li>Imported userinfo.txt (user/group info given to me by Vinh) using Clearquest Designer: User Administration. In looking at the subscriptions I see that groups appear are properly subscribed to databases but the users, particularly admin was not subscribed to any database! I will attempt to apply these user/groups and see if I can get into the db using Clearquest. Nope, as I suspected admin cannot login. Subscribing admin to all databases...</li>

  <li>Upgraded Cont and ContT with imported user/group info. By accident I closed Clearquest Designer and now I can no longer login as admin! Ended up hacking the encrypted password from userinfo.txt back into CQSchema03:master_users:admin:encrypted password! I can now run Clearquest Designer. Subscribed admin to all databases. Also changed my user, adefaria, to no longer attempt to authenticate via LDAP (that never worked anyway) and to be on par with admin (be a superuser, subscribe to all databases and groups, etc.). I can now access Cont via Clearquest client.</li>

  <li>Started pqamerge...</li>

  <li>pqamerge finishes in 7 hours 2 minutes 5 seconds</li>

  <li>Running check_attachments just to be sure</li>

  <li>A quick spot check doesn't show any abnormalities. Vinh can check the data more thoroughly</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  8:21 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000481.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 17, 2005</h2>
                     <a id="a000480"></a>
                     <div class="entry" id="entry-480">
                        <h3 class="entry-header">create_dev_snapview.pl</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Looked into create_dev_snapview.pl.</li>

  <li>Tested speeds of FTP vs. SMB</li>
</ul>
                              
                              <h2>create_dev_snapview.pl</h2>

<blockquote type=cite>
<b>From:</b> Andrew Feltham <br>
<b>Sent:</b> Tuesday, November 15, 2005 3:58 PM<br>
<b>To:</b> Shivdutt Jha<br>
<b>Subject:</b> creating snapshot views <br>
</font><br>

<p>Hi Shivdutt,</p>

<p>so I've tried to use Naga's tool for creating a snapshot view of a particular stream using a variety of  incremental baselines.</p>

<p>I've done this using a file generated by Phil's nightly builds (see attached) which lists the specific baseline which was current for each vob.</p>

<p>First of all, it does not seem to work (see image below). I'm not sure I'm handling the composite baseline label properly</p>

<p>Secondly, I do find the tool a bit awkward as it expects me to input several incremental baselines for vobs which are not included in my load rules.</p>

<p>It would be nice if I could specify the vobs on the cmd line, and only provide those labels.</p>
</blockquote>

<p>Actually the script is working as designed. The arguments for create_dev_snapview.pl are:</p>

<div class="code"><pre>
create_dev_snapview.pl &lt;project_name&gt; [ baseline_selector ]
</pre></div>

<p>project_name is mandatory but baseline_selector is optional. If you don't specify the baseline_selector then it appears that the script takes all the recommended baselines for all components in the project. Or you can specify a list of baselines if you want different ones. The script checks the number of baselines you specified and compares them to the number of <i>modifiable</i> components in the project. These two numbers must agree.</p>

<p>After painstakingly typing in the command line (wish you would have posted the command line in text! :-( ) and running it through Perl's debugger I came to the realization that you typed in 11 (very long) baselines and there are only 10 modifiable components in the ldx_2.3 project.</p>

<p>In thinking of how to do this better I can think of two methods:</p>

<ul>
  <li>Assuming the <span>buildconfig</span>.txt file is a standard file and contains all the information needed, add a -f &lt;buildconfig&gt; option to create_dev_snapview.pl. When present the script would open and parse that file, extracting out the required information. This would help cut down on typing and errors.</li>

  <li>Modify the script to present a series of dialog boxes prompting for the baseline to use for each component in the project. Note that in this instance this would mean a total of 10 dialog box prompts!</li>
</ul>

<p>Either of these options can be added to the existing script via options that cause it to operate in a different way if present or to operate like it used to operate if those options are not present.</p>

<p>(Question: When you type "perl" at your command line, what Perl are you running? Because Perl isn't normally present on Windows. Normally people using Clearcase run ccperl...).</p>

<h2>FTP vs. SMB</h2>

<p>Well this runs contrary to my previous experience but it turns out that a regular file copy using SMB shares is faster than FTP. I tested copying the old 2.7 Gig CQProd2001A database to my desktop, once with FTP and once with SMB. SMB won! Which is surprising to me because last time I tested something like this FTP was up to 10 times faster:</p>

<div class="code"><pre>
Local:time ftpget -u vobadm -p4sjadm p4test . "/dev/d/CQBackupsfromIrvine/0916/CQProd2001A_db_200509160213.BAK"
CQProd2001A_db_200509160213.BAK           2.66 GB    60.35 kB/s

real               769m10.858s
user               1m29.418s
sys                4m36.387s
</pre></div>

<p>Versus:</p>

<div class="code"><pre>
Local:time cp //p4test/CQBackupsfromIrvine/0916/CQProd2001A_db_200509160213.BAK /tmp

real              532m7.457s
user              0m16.714s
sys               1m11.362s
</pre></div>

                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:39 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000480.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 16, 2005</h2>
                     <a id="a000478"></a>
                     <div class="entry" id="entry-478">
                        <h3 class="entry-header">PerlTk</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Continued work on clearprompt replacement in PerlTk.</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  9:13 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000478.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 15, 2005</h2>
                     <a id="a000477"></a>
                     <div class="entry" id="entry-477">
                        <h3 class="entry-header">PerlTK/Bug in pqamerge</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Experimented with PerlTK in an effort to come up with a better Clearprompt for bin_merge</li>

  <li>Vinh found a bug in pqamerge where Prod: Open_Close_Status was not getting transferred to Cont: Active_Deferred_Status</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:19 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000477.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 14, 2005</h2>
                     <a id="a000479"></a>
                     <div class="entry" id="entry-479">
                        <h3 class="entry-header">Finalizing pqamerge</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Identified a few more bugs with pqamerge</li>

  <ul>
    <li>Changed to handle Open_Close_Status -> Active_Deferred_Status for Prod.</li>

    <li>Changed to correctly handle Gating_Item_SW. This is set from GatingItem from both TO and Prod. Gating_Item_HW is a new field and is set to "No".</li>
  </ul>

  <li>Worked with Vinh finalizing steps for pqamerge</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  9:15 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000479.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 12, 2005</h2>
                     <a id="a000476"></a>
                     <div class="entry" id="entry-476">
                        <h3 class="entry-header">Several PQA Fixes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Added Exit Sub/Function to several validation and initialization functions in order to allow TransferState to work</li>

  <li>Fixed some bugs with Fixed_In_SW_Version and OS values of "Novell 6 Pack Beta 3 ". Not sure how this got by before with the trailing space but it raised it's ugly head in TransferStates</li>

  <li>Change pqamerge to treat the Submit state like the Assigned state</li>

  <li>With implementation of ID equality, I have to constantly regenerate the database from scratch. Experienced some problems with this and had to change the schema by allowing admin to submit. This may have been a different problem in that I now need to subscribe all users and groups to Cont database and Upgrade the database each time I create it a new</li>

  <li>Transitioning through states have reveal some fields that where not initially tranfered from the TO database. The fields missed were ResolvedBy, ResolveNote and VerifyNote</li>
</ul>
                              
                              <h2>Additional Schema Action Hook Changes</h2>

<p>In order to set State properly pqamerge needs to transition through states to get to the desired end state. For eample, many defects in Prod are in the Closed state. But when pqamerge first creates the defect in Cont it will be in the Assigned state. In order to get to the Closed state pqamerge need to apply the Resolve, Verify and Close actions. As such it triggers state change action hook code.</p>

<p>For example, in order to transition to the Verified state the Verify action must be applied. When the Verify action happens the action hooks for Verify are run. Part of what they do is initalize owner to blank. It is expected that the user exectuting the Verify action will fill that in. But that messes us up since we are not a person and we already have the "correct" data. Investigating this further reveals other places where, for example, the current date is put into a field such as Resolve_Date and calculations are made in other fields such TimeFromSubmitToResolve. We don't want any of that happening!</p>

<p>To resolve these issues the following Action Hooks have an Exit Sub or Exit Function placed at the beginning of the subroutine or function call so as to avoid the incorrect updating of data fields and so that email is not send out (the other thing many of these Action Hooks do):</p>

<ul>
  <li>Submit: Validation</li>

  <li>Assign: Notification</li>

  <li>Resolve: Initialization; Validation; Notification</li>

  <li>Verify: Initialization; Validation; Notification</li>

  <li>Re-Open: Notification</li>

  <li>Close: Initialization; Notification</li>

  <li>Modify: Notification</li>

  <li>Unassign: Notification</li>

  <li>DoesNotVerify: Initialization; Validation; Notification</li>

  <li>VerifiedPendingCustVerify: Notification</li>

  <li>CustomerVerified: Notification</li>

  <li>Data_Pending: Notification</li>
</ul>

<p>I should have just done all of them or perhaps tried to change the Actions table from use Basic script to script None but the above set seems to be working.</p>

<h2>Data Issue</h2>

<p>Ran the merge and now it's taking 6 hours 54 minutes 39 seconds. This is due to running through the various states to obtain the appropriate state and "burning" IDs so that the IDs match. One remaining problem that I don't know how to fix: Defect Prod00012546 is in the closed state yet lacks any VerifyNote. When transfered to Cont pqamerge tries to go through the states and gets stuck trying to transition this defect from Resolved -> Verify due to the lack of a VerifyNote. I do not know how this happened in the Prod database. The only thing I can think of is that somebody modified Prod00012546 <strong>after</strong> it passed the Verified state blanking out VerifyNote.</p>

<p>I'm running check_attachments now and I expect that to result is 0 differences in attachments.</p>

<div class="code"><pre>
vobadm@P4TEST /dev/d/PQA
$ cqperl W:/it_scm/adm/cq/check_attachments -v
Grand total (old): 2955822684
Grand total (new): 2955822684
</pre></div>


                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:17 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000476.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 11, 2005</h2>
                     <a id="a000475"></a>
                     <div class="entry" id="entry-475">
                        <h3 class="entry-header">Final PQA fixes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Implemented TransferStates</li>

  <li>Found final problem with attachments and fixed it</li>

  <li>Implemented ID number equality</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  1:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000475.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 10, 2005</h2>
                     <a id="a000474"></a>
                     <div class="entry" id="entry-474">
                        <h3 class="entry-header">Finding the missing 261,285,366 bytes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Fixed bug in pqamerge that caused some attachments to not transfer</li>
</ul>
                              
                              <p>I think I've figured out where that missing data went to. As you know the total of the attachment sizes of the old databases compared to the new database was still off but a relatively substantial amount (261,285,366 bytes - see https://defaria.com/blogs/Status/archives/000471.html#more).</p>

<p>I changed check_attachments to help me find where the missing data was. The basic idea was to read all Cont records, total up the attachment size, then use Cont: old_id to locate the old record and total it. With those two figures I could find which records didn't convert correctly.</p>

<p>Turns out:</p>

<div class="code"><pre>
 # At this point we don't have any info about whether we are
 # coming from Prod or TO, however, there are the following fields:
 #
 #          TO               Prod              Cont
 # ----------------------- ----------------------- ----------------
 # Attachments        Attachments        Attachments
 # AttachmentsBRCM        AttachmentBRCM        AttachmentsBRCM
 #
 # You may notice that Prod: AttachmentBRCM is missing the "s".
 # Therefore:
 $field_name = "AttachmentsBRCM" if $field_name eq "AttachmentBRCM";
</pre></div>

<p>Remerging and will run check_attachments again.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 11:55 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000474.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  9, 2005</h2>
                     <a id="a000473"></a>
                     <div class="entry" id="entry-473">
                        <h3 class="entry-header">Removing DBs from a Schema/Email link concerns</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Investigated how to remove databases from a CQ Schema</li>

  <li>Created template files for Clearquest Web Login page to swap in for Phase I and Phase II onto the production web server (under C:\Temp\PQA)</li>

  <li>Discussed the email link problem with Rational. While they can't say definitively what is supported they have stated that the old email link URL will not work in the new schema</li>
<ul>
                              
                              <h2>Databases contained in a Clearquest Schema Database</h2>

<p>A Clearquest connection profile connects to a Clearquest schema database. This schema database defines many things, one of which is which user databases this schema database covers. So with the old 2001 schema all of Prod, TO and NAS is defined in there. The Clearquest Designer has Delete Database and Undelete Database to remove and re-add databases to the schema. This is a misnomer. The schema database has a table, master_dbs, which lists all the user databases that this schema database knows about. What is really happening when you Delete Database is simply that Clearquest Designer is toggling the is_deleted field in master_dbs for this database to 1 meaning it's "deleted". Undelete database merely toggles it back to 0. Being marked deleted means that it will no longer show up as a database to select for Clearquest Windows Clients and the web server. The web server, however, needs to be restarted to notice the change.</p>

<h2>Another Email URL link issue</h2>

<p>With the concept of having multiple Schema repositories and database you are right to be concern about the user being confused when clicking on an email link. Normally the email link is of the format:</p>

<blockquote>
http://<<em>server</em>>/cqweb/url/default.asp?id=<<em>id</em>>
</blockquote>

<p>If the user is logged into CQ Web then they will go directly to the detail defect. If not they will make a brief stop at the login screen. With multiple Schema repositories the user will have to select the proper schema repository and database during login. However you can add on additional parameters to set the default schema repository and database like so:</p>

<blockquote>
http://<<em>server</em>>/cqweb/url/default.asp?id=<<em>id</em>>&dbset=<<em>dbset</em>>&db=<<em>db</em>>
</blockquote>

<p>For example:</p>

<blockquote>
 http://pcsjca-ccrmt03/cqweb/url/default.asp?id=Cont00009460&dbset=2005.02.00&db=Cont
</blockquote>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  3:52 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000473.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  8, 2005</h2>
                     <a id="a000472"></a>
                     <div class="entry" id="entry-472">
                        <h3 class="entry-header">Web Server Configuration and documentation</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Installed Clearquest 2001A.04.00 and verified that it can access Cont</li>

  <li>Figured out how to modify the login page (Clearquest/Web/logon/default_content.asp) and created default_content1.asp and default_content2.asp</li>

  <li>Wrote <a href="http://intranet.broadcom.com/%7Eadefaria/Clearquest/NewCQProfile.php">How to update my Clearquest Profile to access the new Cont database</a>
<ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  7:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000472.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     
                     <a id="a000471"></a>
                     <div class="entry" id="entry-471">
                        <h3 class="entry-header">More on attachments</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Enhanced check_attachments to log better</li>
</ul>
                              
                              <p>Well it's better and didn't take as long as I thought. This time it took 4 hours 34 minutes 49 seconds. Not too bad. And the attachments size is closer. The total attachments for Cont is still &lt; the sum of the attachments from Prod and TO:</p>

<table align="center" border="1" cellpadding="2" cellspacing="0"
 width="75%">
  <tbody>
    <tr>
      <td valign="top">Prod total attachment size<br>
      </td>
      <td align="right" valign="top"> 2,683,569,547</td>
    </tr>
    <tr>
      <td valign="top">TO total attachment size<br>
      </td>
      <td align="right" valign="top"> 272,253,137</td>
    </tr>
    <tr>
      <td valign="top"><b>Total Prod + TO attachment size<br>
      </b></td>
      <td align="right" valign="top"><b> 2,955,822,684</b></td>
    </tr>
    <tr>
      <td valign="top">Cont total attachment size<br>
      </td>
      <td align="right" valign="top"> 2,694,537,318</td>
    </tr>
    <tr>
      <td valign="top"><b>Difference</b><br>
      </td>
      <td align="right" valign="top"><font color="#ff0000"><b>
261,285,366</b></font></td>
    </tr>
  </tbody>
</table>

<p>I'm not sure how to account for that difference.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 10:33 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000471.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  7, 2005</h2>
                     <a id="a000470"></a>
                     <div class="entry" id="entry-470">
                        <h3 class="entry-header">check_attachments</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked out a plan for how to perform the PQA Merge this weekend</li>

  <li>Concerned about the size discrepancy in the database I wrote a little utility, check_attachments, to total up the size of all attachments in all the databases. This turned up a bug in pqamerge which I fixed. Reperforming pqamerge</li>

  <li>There is a problem with using clearprompt to prompt for list input for bin_merge - You can only have one line of prompting text and only 50 characters in that line. It's gonna be hard to describe a binary merge situation in 50 characters or less. Investigated making a PerlTk list dialog. In theory it can be done as ccperl does support PerlTk.</li>

  <li>Discussed with Naga the <i>email link</i> issue with PQA</li>
</ul>
                              
                              <h3>TransferAttachments</h3>

<p>I knew there was a good reason why this was eating at me. There is indeed a bug. My attachments transfer routine was not getting called at all for Prod! I wrote a small Perl script to check this and it yielded:<p>

<div class="code"><pre>
$ cqperl check_attachments
Totaling attachments in TO...
Totaling</span> attachments in Prod...
Totaling</span> attachments in Cont...
Total attachment size for TO = 272253137
Total attachment size for Prod = 2683569547
Total attachment size for Cont = 272253137
</pre></div>

<p>Notice that the size of the attachments for TO matches the size of attachments for Cont! IOW no Prod attachments got transferred at all!</p>

<p>Turns out I was only calling TransferAttachments when the field name was AttachmentsBRCM (and TransferAttachments then did all the attachments - both Attachments and AttachmentsBRCM). However, in Prod the field is named AttachmentBRCM - note the
singularity here! I tell ya my eyes are going.</p>

<p>I'm changing my code not be dependent on the field name and to just call TransferAttachments for each record. TransferAttachments doesn't need to know the field name - it just does all of them.</p>

<p>Unfortunately this means that I have to delete all of the records currently in the Cont database on p4test. And it also means that the approximate 4 hour running time will probably increase. However this does explain the discrepancy in the database sizes.</p>

<h3>Out of Disk Space</h3>

Shivdutt Jha wrote:
<blockquote type=cite>
Good job Andrew, another mystery is solved.
</blockquote>

<p>What is more telling is that we have 2.6 Gig of attachments!</p>

<p>In any event my merge failed with out of disk space. The pqamerge script uses the current directory to temporarily hold the attachments as the are transfered from one DB to the other. Turns out that Prod00010818 has two very large attachments, one 328485466 bytes and another 219095209 bytes. Unfortunately I was running in ~vobadm/My Documents and that disk filled. So another lesson learned - run pqamerge in a directory on a disk with lots of disk space! Alas this means I have to start this process over again (I'm trying to get a clean run and a timing of how long to expect the merge to run. pqamerge outputs how long it takes to do it work).</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000470.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  4, 2005</h2>
                     <a id="a000467"></a>
                     <div class="entry" id="entry-467">
                        <h3 class="entry-header">bin_merge</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Almost code complete on bin_merge. Need to integrate this into UCMCustom</lI>

  <li>Emailed IBM support regarding Clearquest Web URLs</li>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:20 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000467.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  3, 2005</h2>
                     <a id="a000466"></a>
                     <div class="entry" id="entry-466">
                        <h3 class="entry-header">bin_merge/JRE</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Resolved a ticket regarding Clearquest Web (IIS) and not displaying properly. Documented under <a href="http://intranet.broadcom.com/~vobadm/admin_docs/CQJRE.php"></a>Clearquest: Getting the right JRE for Clearquest Web</li>

  <li>Started coding bin_merge</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:49 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000466.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  2, 2005</h2>
                     <a id="a000465"></a>
                     <div class="entry" id="entry-465">
                        <h3 class="entry-header">Enable ldap</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Changed enable_ldap to read from and save to an ldap_settings.cfg file</li>

  <li>Helped Ray with some Perl Regex's</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  4:44 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000465.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  1, 2005</h2>
                     <a id="a000464"></a>
                     <div class="entry" id="entry-464">
                        <h3 class="entry-header">CQ Users/CQ Web Server Setup</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Added a few users to Clearquest</li>

  <li>Set up IIS on pcsjca-ccrmt03</li>

  <li>Set up Clearquest Web on pcsjca-ccrmt03</li>
</ul>
                              
                              <h2>Using the old web server to serve the new Cont database</h2>

<p>Vinh has been wanting to have the old web server software set up alongside the new web server software for two reasons: 1)  as a backup or fail over in case the PQA merge is not working out and 2) as a redirector for old style URLs (with old IDs) to the new server with new IDs. But having to wait for a new server to arrive will cause an unnecessary delay</p>

<p>The thought had been that perhaps the PQA merge could be done and simply use the old web server software to point over to the new database. One question was can the old web server software interact with the merged database seeing as the merged database was done under new Clearquest software. To this end I set up the Clearquest web server software on <tt>pcsjca-ccrmt03</tt> and attempted to access the merged database on <tt>p4test</tt>. And It works! To log in go to <a href="http://pcsjca-ccrmt03/cqweb/login">http://pcsjca-ccrmt03/cqweb/login</a>, set the Schema Repository to 2005.02.00 and log into the Cont database</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  9:43 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000464.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
