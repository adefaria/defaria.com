<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: January  2, 2005 - January  8, 2005 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2004_12_26.html" title="December 26, 2004 - January  1, 2005" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2005_01_09.html" title="January  9, 2005 - January 15, 2005" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2004_12_26.html">&laquo; December 26, 2004 - January  1, 2005</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2005_01_09.html">January  9, 2005 - January 15, 2005 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">January  7, 2005</h2>
                     <a id="a000273"></a>
                     <div class="entry" id="entry-273">
                        <h3 class="entry-header">ecrdesc</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>Well I played around with this a little more and came up with a Perl script that will dump ECR descriptions fairly easy. From what I understand that's mostly what we want access to from a Linux box (though I could envision wanting other things perhaps in the future). The problem as I see it is that this script will only run on lynx12. It should be runnable from any machine really however you would need to install the DBD module for Informix for Perl access. Unfortunately this requires at least an Informix Client SDK and that's not free!  :-(</p>
                              
                              <p>Here's the simple script (currently at lynx12:/tmp/ecrdesc.pl):</p>

<div class="code"><pre>
#!/usr/bin/perl
################################################################################
#
# File:         ecrdesc
# Description:  This script will dump out the description for the ECR #(s)
#               passed in.
# Author:       Andrew@DeFaria.com
# Created:      Fri Jan  7 15:35:13 PST 2005
# Language:     Perl
#
# (c) Copyright 2005, LynxWorks Inc., all rights reserved
#
################################################################################
use strict;
use warnings;
use DBI;

my $DB;

# Called when a database error has occurred
sub DBError {
  my $msg       = shift;
  my $statement = shift;

  print $msg . "\nError #" . $DB->err . " " . $DB->errstr . "\n";

  if (defined $statement) {
    print "SQL Statement: $statement\n";
  } # if

  exit $DB->err;
} # DBError

# Connect to database. Note this is using anonymous access (read only)
$DB = DBI->connect("DBI:Informix:lynxmigr1")
  or DBError "Unable to open database";

# Loop through ECR #s from the command line
foreach my $ecr (@ARGV) {
  print "ECR #: $ecr\n";

  my $statement    = "select description from defect where pkey=\"$ecr\"";
  my $sth    = $DB->prepare ($statement)
    or DBError "Unable to prepare statement", $statement;

  $sth->execute ()
    or DBError "Unable to execute statement", $statement;

  # Defect records are unique per pkey (AKA ECR) there for there will
  # only be one entry in @row. Also the description is returned as one
  # large string.
  my @row = $sth->fetchrow_array;

  if (!@row) {
    # @row is empty if there was no ECR by that number
    print "Nothing found!\n";
  } else {
    my $desc = pop @row;
    print "Description:\n" . "-" x 80 . "\n" . $desc . "\n" . "-" x 80 . "\n";
  } # if
} # foreach

$DB->disconnect;

exit;
</pre></div>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  4:03 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000273.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">January  6, 2005</h2>
                     <a id="a000272"></a>
                     <div class="entry" id="entry-272">
                        <h3 class="entry-header">Files4ecr</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>

<li>Finished up files4ecr</li>

<li>PPC toolchain build W/23084 is failing</li>

</ul>
                              
                              <h3>files4ecr</h4>

<p>From the <a href="news:gnu.cvs.help">gnu.cvs.help</a> newsgroup I learned that doing a cvs log of everything then grepping through that is <b>much</b> faster than interrogating each file with cvs log. I then reorganized files4ecr to work in the following manner:</p>

<p>It occurred to me that often we wish to know, or pull, the file
revision associated with an ECR #. I've created a script called
files4ecr that accomplishes this:</p

<div class="code"><pre>
<font color="#3333ff">saturn:</font><u>files4ecr-u</u>
Usage: files4ecr [-v] [-d] [-l] [-x] [-u] &lt;ecr&gt;

Where:
 
        -v:     Turn on verbose mode (Default: off)
        -d:     Turn on debug mode (Default: off)
        -l:     Local directory only, no recursion
        -x:     Turn on execute mode (Default: off)
        -u:     Dsplay usage
        ecr     ECR number to search for
</pre>
</div>

<p>The performance for this script is pretty good, depending on the amount of information in the CVS logs. Here's an example of it's usage:</p>

<div class="code"><pre>
<font color="#3333ff"><b>saturn:</b></font><u>files4ecr 20505</u>
SETUP.csh: 10.2 - Out of date
etc/tconfig: 10.2 - Already up to date
SETUP.bash: 10.6 - Out of date
etc/ttys-arm: 1.1 - Already up to date
Makefile: 10.13 - Out of date
</pre></div>

<p>In noexecute mode it just displays the file and the revision of the
file associated with that ECR. The -l option is similar to cvs' -l option:</p>

<div class="code"><pre>
<font color="#3333ff">saturn:</font><u>files4ecr -l 20505</u>
SETUP.csh: 10.2 - Out of date
SETUP.bash: 10.6 - Out of date
Makefile: 10.13 - Out of date
</pre></div>

<p>Also, like cvs, files4ecr operates in the current context and current
working directory.</p>

<p>With -x turned on files4ecr will perform the cvs update commands
necessary to "pull" the versions for the ECR:</p>

<div class="code"><pre>
<font color="#3333ff">saturn:</font><u>files4ecr -x 20505</u>
cvs update -r10.2&nbsp; SETUP.csh - Updated
cvs update -r10.2&nbsp; etc/tconfig - Already up to date
cvs update -r10.6&nbsp; SETUP.bash - Updated
cvs update -r1.1&nbsp; etc/ttys-arm - Already up to date
cvs update -r10.13&nbsp; Makefile - Updated
</pre></div>

<p>And we can see that the update has taken place:</p>

<div class="code"><pre>
<font color="#3333ff">saturn:</font><u>files4ecr 20505</u>
SETUP.csh: 10.2 - Already up to date
etc/tconfig: 10.2 - Already up to date
SETUP.bash: 10.6 - Already up to date
etc/ttys-arm: 1.1 - Already up to date
Makefile: 10.13 - Already up to date
</pre></div>

<p>Anybody interested in such a script?</p>

<p><b>Note:</b> I've noticed that "ECR Number:" is not necessarily a
consistent indicator of an ECR number. I search for several strings:</p>

<div class="code"><pre>
/^ECR Number: (\d*)$/    or
/^ECR# (\d*)$/           or
/^ECR # (\d*)$/          or
/^\s*ECR (\d*)/
</pre></div>

<p>I've also noticed that a single ECR number may be attached to several revisions. files4ecr takes the latest revision in such cases.</p>

<h2>PPC toolchain build W/23084 is failing</h2>

<p>Preliminary investigation shows that while attempting to configure libiberty the build process is unable to use gcc to compile things. It seems to be lacking a crt1.o</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 10:31 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000272.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">January  4, 2005</h2>
                     <a id="a000271"></a>
                     <div class="entry" id="entry-271">
                        <h3 class="entry-header">files4ecr.pl</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>The algorithm that files4ecr.pl uses is indeed slow. Combing through lynxos looking for files involved in ECR 20591 took:</p>

<div class="code">
<pre>
real    416m30.889s
user    6m43.900s
sys     1m42.770s
</pre>
</div>

<p>Yikes!</p>

                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:43 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000271.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     
                     <a id="a000270"></a>
                     <div class="entry" id="entry-270">
                        <h3 class="entry-header">Building Native Toolchain for PPC</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>Here's the plan:</p>

<ol>

<li>Build Toolchain with PPC fix ECR 23084</li>

<li>Build LynxOS with the new toolchain</li>

<li>Build Toolchain natively</li>

</ol>

                              
                              <h3>Toolchain build with PPC ECR 23084 fix</h3>

<p>Seems the individual files for this ECR have already been applied to the work area so I just need to build. Here what I did:</p>

<ul>

<li>In <tt>dopey:/export/build1/LYNXOS_500/build/toolchain/3.2.2</tt> I created a directory named 010405 (for today's date).</li>

<li>Copied a Makefile from 121804/Makefile. With the toolchain all we need is a good make file, make sure that it's SRCDIR is correct (this one points to <tt>/export/build1/LYNXOS_500/work-area/toolchain/3.2.2/toolchain/src</tt>) and that you source <tt>SETUP.bash</tt> setting ENV_PREFIX and target properly (I used <tt>/export/build1/LYNXOS_500/build/lynxos/120604-B/ppc</tt> and, of course, PPC for a target)</li>

<li>Sourced SETUP.bash</li>

<li>Did <tt>make install > install.log 2>&1</tt></li>

</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:08 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000270.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     
                     <a id="a000269"></a>
                     <div class="entry" id="entry-269">
                        <h3 class="entry-header">TOT Build Failure</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>

<li>Unable to build TOT due to error in definition of atoi</li>

</ul>
                              
                              <p>Is there a known problem with TOT build? Cause I'm getting an error saying essentially that "atoi is undefined".</p>

<div class="code">
<pre>
gcc -g -O2 -o named aclconf.o client.o config.o control.o controlconf.o interfac
emgr.o listenlist.o log.o logconf.o main.o notify.o query.o server.o sortlist.o
tkeyconf.o tsigconf.o update.o xfrout.o zoneconf.o lwaddr.o lwresd.o lwdclient.o
lwderror.o lwdgabn.o lwdgnba.o lwdgrbn.o lwdnoop.o lwsearch.o  unix/os.o ../../
lib/lwres/liblwres.a ../../lib/dns/libdns.a   ../../lib/isccfg/libisccfg.a ../..
/lib/isccc/libisccc.a ../../lib/isc/libisc.a  -lnsl
/export/build1/LYNXOS_500/build/lynxos/120604-C/x86/lib/libnsl.a(getgrent.as.o):
In function `getgrent':
getgrent.as.o(.text+0xb4): undefined reference to `atoi'
/export/build1/LYNXOS_500/build/lynxos/120604-C/x86/lib/libnsl.a(getgrent.as.o):
In function `fgetgrent':
getgrent.as.o(.text+0x2b8): undefined reference to `atoi'
/export/build1/LYNXOS_500/build/lynxos/120604-C/x86/lib/libnsl.a(getpwent.as.o):
In function `getpwent':
getpwent.as.o(.text+0xb4): undefined reference to `atoi'
getpwent.as.o(.text+0xce): undefined reference to `atoi'
/export/build1/LYNXOS_500/build/lynxos/120604-C/x86/lib/libnsl.a(getpwent.as.o):
In function `getpw':
getpwent.as.o(.text+0x29e): undefined reference to `atoi'
/export/build1/LYNXOS_500/build/lynxos/120604-C/x86/lib/libnsl.a(getpwent.as.o)(
.text+0x34c): more undefined references to `atoi' follow
collect2: ld returned 1 exit status
make[4]: *** [named] Error 1
<pre>
</div>

<p>It seems that the problem is in strtol.c version 10.2, which says that the definition was moved to stdlib.h, and stdlib.h appears to have it, yet the build fails anyway...</p>

<p>Looking at the compilation line for strtol.c I see it produces strtol.as.o, which in a previous successful build yeilds:</p>

<div class="code">
<pre>
$ nm strtol.as.o
        U __ctype
        U __divdi3
        U __moddi3
        U _errno
00000208 T atoi
000001f4 T atol
00000000 T strtol
</pre>
</div>

<p>But in this build yeilds:</p>

<div class="code">
<pre>
$ nm strtol.as.o
        U __ctype
        U __divdi3
        U __moddi3
        U _errno
00000208 T atoi
000001f4 T atol
00000000 T strtol
</pre>
</div>

<p>So how do we fix this error?</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 11:03 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000269.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">January  3, 2005</h2>
                     <a id="a000268"></a>
                     <div class="entry" id="entry-268">
                        <h3 class="entry-header">files4ecr.pl/Building TOT as per instructions</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>

<li>Worked on getting files4ecr.pl to work</li>

<li>Attempted to rebuild TOT using the documentation created so far as a guide. Ran out of disk space! :-(</li>

<li>More documentation of build/test/release process</li>

</ul>
                              
                              <h3>files4ecr.pl</h3>

<p>The daily CVS Checkin Log works by creating a temporary CVS area based on a tag then doing a cvs update capturing what files have changed. Those files are examined and a report is produced by ECR number.</p>

<p>While this works fairly well and is relatively optimized (only working on the files that changed since the label) it may not be that accurate. It seems to assume that all files for an ECR are checked in together and on the same day. What if, for example, somebody checked in a file for an ECR days ago and it now checking in the rest of the work? The files reported for this ECR may  be incomplete.</p>

<p>Here's an example of where this happened. In today's CVS Checkin Log email the following files are listed as associated with ECR # 20591:<p>

<pre>
ECR Number:  20591
	src/lib/libc/strto_int.c              10.2    	zhuravle	2004/12/27 16:11:21
	src/lib/libc/strto_real.c             10.2    	zhuravle	2004/12/27 16:09:47
	src/lib/libc/strto_real.h             10.2    	zhuravle	2004/12/27 16:09:47
	src/lib/libc/strtod.c                 10.4    	zhuravle	2004/12/27 16:09:47
	src/lib/libc/strtof.c                 10.2    	zhuravle	2004/12/27 16:09:47
	src/lib/libc/strtoimax.c              10.2    	zhuravle	2004/12/27 16:11:58
	src/lib/libc/strtol.c                 10.2    	zhuravle	2004/12/27 16:11:58
	src/lib/libc/strtold.c                10.2    	zhuravle	2004/12/27 16:09:48
	src/lib/libc/strtoll.c                10.3    	zhuravle	2004/12/27 16:11:58
	src/lib/libc/strtoul.c                10.2    	zhuravle	2004/12/27 16:11:58
	src/lib/libc/strtoull.c               10.3    	zhuravle	2004/12/27 16:11:58
	src/lib/libc/strtoumax.c              10.2    	zhuravle	2004/12/27 16:11:58
	usr/include/rcsid.h                   10.2    	zhuravle	2004/12/27 15:57:50
	usr/include/stdlib.h                  10.10   	zhuravle	2004/12/27 16:07:26
</pre>

<p>Yet thoroughly scanning the CVS logs we find:</p>

<pre>
ECR Number: 20591 Nbr of files: 25

Nbr Path/File                           Version   Author    Date
--- ----------------------------------- ------- ----------- -------------------
  1 strtoull.c                           10.3   zhuravle    2004/12/27 16:11:58
  2 strtoull.c                           10.2   zhuravle    2004/10/22 12:04:48
  3 Makefile                             10.18  zhuravle    2004/10/22 12:04:47
  4 strto_int.c                          10.2   zhuravle    2004/12/27 16:11:21
  5 strto_int.c                          10.1   zhuravle    2004/10/22 12:04:48
  6 strtold.c                            10.2   zhuravle    2004/12/27 16:09:48
  7 strtold.c                            10.1   zhuravle    2004/10/22 12:04:48
  8 strtoll.c                            10.3   zhuravle    2004/12/27 16:11:58
  9 strtoll.c                            10.2   zhuravle    2004/10/22 12:04:48
 10 strtoul.c                            10.2   zhuravle    2004/12/27 16:11:58
 11 strtoul.c                            10.1   zhuravle    2004/10/22 12:04:48
 12 strtoimax.c                          10.2   zhuravle    2004/12/27 16:11:58
 13 strtoimax.c                          10.1   zhuravle    2004/10/22 12:04:48
 14 strtoumax.c                          10.2   zhuravle    2004/12/27 16:11:58
 15 strtoumax.c                          10.1   zhuravle    2004/10/22 12:04:48
 16 strto_real.c                         10.2   zhuravle    2004/12/27 16:09:47
 17 strto_real.c                         10.1   zhuravle    2004/10/22 12:04:48
 18 strto_real.h                         10.2   zhuravle    2004/12/27 16:09:47
 19 strto_real.h                         10.1   zhuravle    2004/10/22 12:04:48
 20 strtod.c                             10.4   zhuravle    2004/12/27 16:09:47
 21 strtod.c                             10.3   zhuravle    2004/10/22 12:04:48
 22 strtof.c                             10.2   zhuravle    2004/12/27 16:09:47
 23 strtof.c                             10.1   zhuravle    2004/10/22 12:04:48
 24 strtol.c                             10.2   zhuravle    2004/12/27 16:11:58
 25 strtol.c                             10.1   zhuravle    2004/10/22 12:04:48

</pre>

<p>Now files4ecr.pl thoroughly checks all CVS logs (based on the paths it is givin that is) but this takes a <b>lot</b> of time.</p>

<p>Note that Makefile is listed by files4ecr.pl but not in the daily CVS Checking Log. That's because Makefile was checked in with that ECR number a while ago. The daily CVS Checkin Log does not reflect this historical fact.</p>

<p>Also note that ECR's unlike tags that can only exist on one revision, ECR numbers are just strings placed in the check in comment. Thus there is the possibility that they will exist on more than one revision (e.g. strtod.c versions 10.4 and 10.3). IOW checking in another version of a file and using the same ECR number will not remove the ECR number in the command of a previous version of the file!</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 11:18 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000268.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
