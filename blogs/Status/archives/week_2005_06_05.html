<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: June  5, 2005 - June 11, 2005 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2005_05_29.html" title="May 29, 2005 - June  4, 2005" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2005_06_12.html" title="June 12, 2005 - June 18, 2005" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2005_05_29.html">&laquo; May 29, 2005 - June  4, 2005</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2005_06_12.html">June 12, 2005 - June 18, 2005 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">June 10, 2005</h2>
                     <a id="a000370"></a>
                     <div class="entry" id="entry-370">
                        <h3 class="entry-header">Issues building LOS178 with 3.4.3 toolchain</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <p>I experienced the following issues when attempting to build LOS178 with the 3.4.3 toolchain:</p>

<h3>Need to have xcoff cdk</h3>

<p>In order to perform the build the xcoff version of the cdk needs to be untarred. This was obtained from 2.0.0 (98r2) tarball:</p>

<div class="code"><pre>
    $ tar -zxpf ../1033-00.cdklinux.tar.gz
</pre></div>

<br>

<h3>Need to get files from ppc.cdksol.tar.gz from sys/miscgcc</h3>

<p>In order to perform the build one needs to extract files from bin-image/ppc.cdksol.tar.gz, specifically the sys/miscgcc area:</p>

<div class="code"><pre>
    $ tar -zxpf ../bin-image/ppc.cdksol.tar.gz sys/miscgcc
</pre></div>

<br>

<h3>Need to extract 3.4.3 toolchain</h3>

<p>After successfully building 3.4.3 gcc, package it up and then use it to extract here:</p>

<div class="code"><pre>
$ tar -zxpf ../toolchain/toolchain-i686-pc-linux-gnu-powerpc178.tar.gz
</pre></div>

<br>

<h3>Toolchain's cdk/linux-elf-ppc lacks a bin directory</h3>

<p>Normally under cdk/linux-xcoff-ppc there is both a usr and a bin directory. Some entities are just a symlink back to their counterparts in ../usr/bin (e.g. ld -> ../usr/bin/ld). This bin directory structure is not present after untarring toolchain-i686-pc-linux-gnu-powerpc178.tar.gz. For building purposes the following was done:</p>

<ol>
  <li>Create a bin directory in cdk/linux-xcoff.ppc</li>

  <li>Create symlinks to ../usr/bin:

<div class="code"><pre>
      $ for link in ar as byacc c++ cmp diff diff3 expect flex gcc ld \
      > make nm ranlib size strip; do
      > ln -s ../usr/bin/$link $link
      > done
</pre></div>

      Note: Some of these are probably not necessary</li>

  <li>Copy the following files from linux-xcoff-ppc/bin -> linux-elf-ppc/bin:

<div class="code"><pre>
      $ for file in bison bison.hairy bison.simple coffcorrupt cofflook \
      > config crc elflook gnutar gunzip gzcat gzexe gzip install mkbootprep \
      > mkimage mktimestamp prepend-crc vctchk yacc zcmp zdiff zforce zgrep \
      > zmore znew; do
      > cp ../../linux-xcoff-ppc/bin/$file $file
      > done
</pre></div>

      Note: Some of these are probably not necessary</li>
</ol>

<h3>libgcc.a not present</h3>

<p>The build failed because it was unable to find libgcc.a. The solution was to copy libgcc.a into the right place:</p>

<div class="code"><pre>
    $ mkdir lib
    $ cp cdk/linux-elf-ppc/usr/lib/gcc/powerpc-lynx-lynxos178/3.4.3/libgcc.a lib
</pre></div>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  3:53 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000370.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">June  9, 2005</h2>
                     <a id="a000369"></a>
                     <div class="entry" id="entry-369">
                        <h3 class="entry-header">3.4.3 toolchain build/LOS178 Makefile global clean/clobber</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>As Moscow had checked in changes I was instructed to reattempt to build 3.4.3 toolchain again. Toolchain builds on both RH 8.0 and 9.0 but LOS178 fails to build</li>

  <li>Made changes to LOS178 top level Makefile to support global clean and clobber targets. Need CR to check this in...</li>
</ul>
                              
                              <h3>3.4.3 Toolchain builds</h3>
Vinnie So wrote:

<blockquote type=cite>
<p>Andrew,</p>

<p>On the other part I just wrote the high level instruction you know what to do.</p>

<p>--Vinnie</p>

<p>1. check out compiler TOT from t3:/cvs/gcc-cvs</p>

<div class="code"><pre>
# cvs co -P toolchain
</pre></div>
</blockquote>

OK.

<blockquote type=cite>
<p>2. Apply tag DEV_LOS178_3p0p0_ppc_20050609</p>
</blockquote>

<p>To the toolchain?!?</p>

<blockquote type=cite>
<p>3. check out los178 & check out bin-image (TOT)</p>
<div class="code"><pre>
# cvs co -P bin-image
# cvs co -P los178
</pre></div>
</blockquote>

<p>OK.</p>

<blockquote type=cite>
<p>4. Apply tag DEV....... you know what this is</p>
</blockquote>

<p>I assume you mean to los178... (bin-image?)</p>

<blockquote type=cite>
<p>5. extract linux cdk (98r2) into the los178 build tree</p>

<div class="code"><pre>
t3:/export/dev_archive/los178/2p0p0/20050228/solaris/media/ppc/1033-00.cdklinux.tar.gz
</pre></div>
</blockquote>

<p>OK</p>

<blockquote type=cite>
<p>6. extract sys/miscgcc from bin-image/ppc.cdksol.tar.gz into los178 build tree</p>

<div class="code"><pre>
# gnutar zxpf bin-image/ppc.cdksol.tar.gz sys/miscgcc
</pre></div>

<p>This is needed since kernel is still xcoff. Once kernel is elf you will need elf miscgcc object files.</p>
</blockquote>

<p>OK.</p>

<blockquote type=cite>
<p>7. In the los178 build tree source SETUP.bash</p>
</blockquote>

<p>OK.</p>

<blockquote type=cite>
<p>8. Change to the toolchain directory & do whatever setup is needed and build the compiler</p>
</blockquote>

<p>OK. Damn it worked! (RH 9.0 - still waiting for RH 8.0...)</p>

<blockquote type=cite>
<p>9. package the toolchain & extract into the los178 build tree</p>
</blockquote>

<p>OK</p>

<blockquote type=cite>
<p>10. build the los178</p>
</blockquote>

<p>Experienced problems. First problem is that cdk/linux-elf-ppc lacked a bin directory, therefore $ENV_PREFIX/cdk/linux-elf-ppc/bin/make did not exist. Looking at linux-xcoff-ppc/bin I see that some files are simply symlinks to ../usr/bin/<file> and others are actual files. Using the file(1) command I see that the files under linux-xcoff-ppc/bin that are not symlinks are ELF files! Odd.</p>

<p>So recreating (symlinking symlinks and copying files) $ENV_PREFIX/cdk/linux-xcoff-ppc/bin -> $ENV_PREFIX/cdk/linux-elf-ppc/bin and attempting the build yielded errors. Discussing this with Vinnie we performed the following actions:</p>

<ul>
  <li>Copied cdk/linux-elf-ppc/usr/lib/gcc/powerpc-lynx-lynxos178/3.4.3/libgcc.a -> $ENV_PREFIX/lib</li>

  <li>Created the /usr/los178/2.0.0/ppc_dev/cdk/linux-xcoff-ppc/bin directory and placed a copy of bison.simple from cdk/linux-xcoff-ppc/bin into that directory</li>

  <li>Reperformed the build of LOS178</li>
</ul>

<p>Now, on Europa - a RH 8.0 machine - I have many errors all stating:</p>

<div class="code"><pre>
    /build/los178/cdk/linux-xcoff-ppc/bin/ar: /build/los178/sys/lib/libdrivers.a: File format is ambiguous
    /build/los178/cdk/linux-xcoff-ppc/bin/ar: Matching formats: elf32-powerpc elf32-little elf32-big
    make[5]: *** [/build/los178/sys/lib/libdrivers.a(rddrvr.o)] Error 1
</pre></div>

<p>The log file is on europa:/build/los178/install.log</p>

<h3>Global clean and clobber targets</h3>

<p>In order to support global clean and clobber targets on LOS178's top level Makefile the following changes need to be done:</p>

<ul>
  <li>Add clean and clobber to .PHONY</li>

  <li>Change help target to describe new targets</li>

  <li>Add clean and clobber targets that essentially loop through $(DIRS) and perform make [clean|clobber]</li>
</ul>

<p>Via cvs diff:</p>

<div class="code"><pre>
Index: Makefile
===================================================================
RCS file: /cvs/los178-cvs/los178/Makefile,v
retrieving revision 1.7
diff -r1.7 Makefile
22c22
< .PHONY: help all install setup asmstat asmstatclean
---
> .PHONY: help all install setup asmstat asmstatclean clean clobber
24a25
>       @echo "This Makefile is use to build the entire LOS178, for example:"
26,27d26
<       @echo "This Makefile is use to build the entire LOS178"
<       @echo " for example:"
31c30,33
<
---
>       @echo "Additionally the following targets are supported"
>       @echo ""
>       @echo "     make clean"
>       @echo "     make clobber"
55a58,66
>
> # Global clean and clobber targets
> clean:
>       @for dir in $(DIRS); do \
>               (cd $$dir && make clean); done
>
> clobber:
>       @for dir in $(DIRS); do \
>               (cd $$dir && make clobber); done

</pre></div>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  3:05 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000369.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">June  8, 2005</h2>
                     <a id="a000368"></a>
                     <div class="entry" id="entry-368">
                        <h3 class="entry-header">2.1.0 problem/3.4.3 gcc/GDB 6.0</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Rebuilding LOS178 2.1.0</li>

  <li>Attempted to build 3.4.3 on RH 8.0. Didn't work. Reattempting on RH 9.0 machine, shrike</li>

  <li>Setup coolcat Windows box to attempt to build GDB 6.0</li>

  <li>Changed Logger.pm to set autoflush</li>

  <li>Changed build_los178 to look for sendmail</li>

  <li>Worked on improving rename.sh to handle multiple versions. More works need to be done.</li>
</ul>
                              
                              <h3>LOS178 2.1.0</h3>

<p>There was some sort of problem with the recent build of 2.1.0. In looking into it I found the following:</p>

<p>I found a tagging problem. I used the tag DEV_LOS178_3p0p0_ppc_20050603. Note the 3p0p0. It should have been 2p1p0. I searched dev_archive on t3 and find no 20050603 directory for 3p0p0 but find it instead under 2p1p0. I believe that I should simply rename that tag to DEV_LOS178_2p1p0_20050603.</p>

<p>The CRs involved in 1 gig support seem to be: 539 and 606. Additionally 620 appears to be picked. Here's the break down:</p>

<div class="code"><pre>
    rock:files4cr 539 # Add 1Gb support for LynxOS-178
    ENVIRONMENT: 1.9.2.2 - Already up to date
    src/bin/lynxos.boot/Makefile: 1.1.1.1.2.1 - Already up to date
    src/cdk/common/mkimage/coff.c: 1.1.2.1 - Already up to date
    sys/bsp.vmpc/bsp_env.c: 1.2.2.1 - Already up to date
    sys/bsp.vmpc/lowInit.c: 1.3.2.1 - Already up to date
    sys/bsp.vmpc/procinit.c: 1.3.2.1 - Already up to date
    sys/csp.970/csp_init.c: 1.2.2.1 - Out of date
    sys/csp.970/csp_mem_map.c: 1.4.2.1 - Out of date
    sys/csp.ppc/csp_init.c: 1.2.2.1 - Already up to date
    sys/csp.ppc/csp_mem_map.c: 1.3.2.1 - Already up to date
    sys/include/bsps/pmac_g5/board.h: 1.5.2.1 - Out of date
    sys/include/bsps/vmpc/board.h: 1.2.2.1 - Already up to date
    sys/include/bsps/vmpc/pwb.h: 1.1.2.1 - Already up to date
    sys/include/family/ppc/arch_mem.h: 1.1.1.1.2.1 - Already up to date

    rock:files4cr 606 # Fix the 1GB problem on the Apple Power Mac G5 LynxOS-178 BSP
    sys/bsp.pmac_g5/bsp_env.c: 1.2.2.1 - Already up to date
    sys/bsp.pmac_g5/bsp_init.c: 1.3.2.2 - Already up to date
    sys/bsp.pmac_g5/ofw.c: 1.5.2.1 - Already up to date
    sys/bsp.pmac_g5/ofw.h: 1.3.2.1 - Already up to date
    sys/bsp.pmac_g5/procinit.c: 1.5.2.1 - Already up to date
    sys/csp.970/csp_init.c: 1.2.2.2 - Already up to date
    sys/csp.970/csp_mem_map.c: 1.4.2.2 - Out of date
    sys/include/bsps/pmac_g5/board.h: 1.5.2.2 - Already up to date
    sys/kernel/getrusage.c: 1.1.1.1.2.1 - Already up to date

    rock:files4cr 620 # Import G5 bug fixes/improvement from TOT into 2.1.0 branch
    sys/bsp.pmac_g5/bsp_intr.c: 1.2.2.1 - Already up to date
    sys/csp.970/csp_mem_map.c: 1.4.2.3 - Already up to date
    sys/drivers/arinc653/Makefile.real: 1.1.2.1 - Already up to date
</pre></div>

<p>If you look carefully you'll notice that the "Out of date" items for 539 are covered with newer versions in 606 and 620. So it appears as if I was up to date with when I built.</p>

<p>I am building again and will be rereleasing images using the correct numbering this time.</p>

<h3>Building 3.4.3 gcc on shrike RH 9.0</h3>

<p>I attempted to build 3.4.3 gcc on shrike, a RH 9.0 system but it failed with the following:</p>

<div class="code"><pre>
    make[2]: Entering directory `/home/adefaria/toolchain/build-powerpc/bison'
    cd /home/adefaria/toolchain.orig/src/bison && autoheader
    WARNING: Using auxiliary files such as `acconfig.h', `config.h.bot'
    WARNING: and `config.h.top', to define templates for `config.h.in'
    WARNING: is deprecated and discouraged.

    WARNING: Using the third argument of `AC_DEFINE' and
    WARNING: `AC_DEFINE_UNQUOTED' allows to define a template without
    WARNING: `acconfig.h':

    WARNING:   AC_DEFINE([NEED_MAIN], 1,
    WARNING:             [Define if a function `main' is needed.])

    WARNING: More sophisticated templates can also be produced, see the
    WARNING: documentation.
    touch /home/adefaria/toolchain.orig/src/bison/config.hin
    cd . && /bin/sh ./config.status config.h
    Usage: ./config.status [--recheck] [--version] [--help]
    make[2]: *** [stamp-h1] Error 1
    make[2]: Leaving directory `/home/adefaria/toolchain/build-powerpc/bison'
    make[1]: *** [all-bison] Error 2
    make[1]: Leaving directory `/home/adefaria/toolchain/build-powerpc'
    make: *** [stamp-all-powerpc] Error 2
</pre></div>

<p>Here's what I did:</p>

<ul>
  <li>Checked out toolchain from my previous tag (DEV_LOS178_3p0p0_ppc_20050607)</li>

  <li>Obtained and applied the patches as before</li>

  <li>Obtained the LOS178 build environment as before</li>

  <li>Performed make install</li>
</ul>

<p>This was done on shrike in my home directory.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:11 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000368.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">June  7, 2005</h2>
                     <a id="a000367"></a>
                     <div class="entry" id="entry-367">
                        <h3 class="entry-header">build_los178 enhancements/3.4.3 toolchain build</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Changed build_los178 to log results using Logger and to report results by emailing them</li>

  <li>Started on 3.4.3 toolchain build</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  2:29 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000367.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
