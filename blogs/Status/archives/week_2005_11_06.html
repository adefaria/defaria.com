<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: November  6, 2005 - November 12, 2005 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2005_10_30.html" title="October 30, 2005 - November  5, 2005" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2005_11_13.html" title="November 13, 2005 - November 19, 2005" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2005_10_30.html">&laquo; October 30, 2005 - November  5, 2005</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2005_11_13.html">November 13, 2005 - November 19, 2005 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">November 12, 2005</h2>
                     <a id="a000476"></a>
                     <div class="entry" id="entry-476">
                        <h3 class="entry-header">Several PQA Fixes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Added Exit Sub/Function to several validation and initialization functions in order to allow TransferState to work</li>

  <li>Fixed some bugs with Fixed_In_SW_Version and OS values of "Novell 6 Pack Beta 3 ". Not sure how this got by before with the trailing space but it raised it's ugly head in TransferStates</li>

  <li>Change pqamerge to treat the Submit state like the Assigned state</li>

  <li>With implementation of ID equality, I have to constantly regenerate the database from scratch. Experienced some problems with this and had to change the schema by allowing admin to submit. This may have been a different problem in that I now need to subscribe all users and groups to Cont database and Upgrade the database each time I create it a new</li>

  <li>Transitioning through states have reveal some fields that where not initially tranfered from the TO database. The fields missed were ResolvedBy, ResolveNote and VerifyNote</li>
</ul>
                              
                              <h2>Additional Schema Action Hook Changes</h2>

<p>In order to set State properly pqamerge needs to transition through states to get to the desired end state. For eample, many defects in Prod are in the Closed state. But when pqamerge first creates the defect in Cont it will be in the Assigned state. In order to get to the Closed state pqamerge need to apply the Resolve, Verify and Close actions. As such it triggers state change action hook code.</p>

<p>For example, in order to transition to the Verified state the Verify action must be applied. When the Verify action happens the action hooks for Verify are run. Part of what they do is initalize owner to blank. It is expected that the user exectuting the Verify action will fill that in. But that messes us up since we are not a person and we already have the "correct" data. Investigating this further reveals other places where, for example, the current date is put into a field such as Resolve_Date and calculations are made in other fields such TimeFromSubmitToResolve. We don't want any of that happening!</p>

<p>To resolve these issues the following Action Hooks have an Exit Sub or Exit Function placed at the beginning of the subroutine or function call so as to avoid the incorrect updating of data fields and so that email is not send out (the other thing many of these Action Hooks do):</p>

<ul>
  <li>Submit: Validation</li>

  <li>Assign: Notification</li>

  <li>Resolve: Initialization; Validation; Notification</li>

  <li>Verify: Initialization; Validation; Notification</li>

  <li>Re-Open: Notification</li>

  <li>Close: Initialization; Notification</li>

  <li>Modify: Notification</li>

  <li>Unassign: Notification</li>

  <li>DoesNotVerify: Initialization; Validation; Notification</li>

  <li>VerifiedPendingCustVerify: Notification</li>

  <li>CustomerVerified: Notification</li>

  <li>Data_Pending: Notification</li>
</ul>

<p>I should have just done all of them or perhaps tried to change the Actions table from use Basic script to script None but the above set seems to be working.</p>

<h2>Data Issue</h2>

<p>Ran the merge and now it's taking 6 hours 54 minutes 39 seconds. This is due to running through the various states to obtain the appropriate state and "burning" IDs so that the IDs match. One remaining problem that I don't know how to fix: Defect Prod00012546 is in the closed state yet lacks any VerifyNote. When transfered to Cont pqamerge tries to go through the states and gets stuck trying to transition this defect from Resolved -> Verify due to the lack of a VerifyNote. I do not know how this happened in the Prod database. The only thing I can think of is that somebody modified Prod00012546 <strong>after</strong> it passed the Verified state blanking out VerifyNote.</p>

<p>I'm running check_attachments now and I expect that to result is 0 differences in attachments.</p>

<div class="code"><pre>
vobadm@P4TEST /dev/d/PQA
$ cqperl W:/it_scm/adm/cq/check_attachments -v
Grand total (old): 2955822684
Grand total (new): 2955822684
</pre></div>


                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:17 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000476.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 11, 2005</h2>
                     <a id="a000475"></a>
                     <div class="entry" id="entry-475">
                        <h3 class="entry-header">Final PQA fixes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Implemented TransferStates</li>

  <li>Found final problem with attachments and fixed it</li>

  <li>Implemented ID number equality</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  1:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000475.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November 10, 2005</h2>
                     <a id="a000474"></a>
                     <div class="entry" id="entry-474">
                        <h3 class="entry-header">Finding the missing 261,285,366 bytes</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Fixed bug in pqamerge that caused some attachments to not transfer</li>
</ul>
                              
                              <p>I think I've figured out where that missing data went to. As you know the total of the attachment sizes of the old databases compared to the new database was still off but a relatively substantial amount (261,285,366 bytes - see https://defaria.com/blogs/Status/archives/000471.html#more).</p>

<p>I changed check_attachments to help me find where the missing data was. The basic idea was to read all Cont records, total up the attachment size, then use Cont: old_id to locate the old record and total it. With those two figures I could find which records didn't convert correctly.</p>

<p>Turns out:</p>

<div class="code"><pre>
 # At this point we don't have any info about whether we are
 # coming from Prod or TO, however, there are the following fields:
 #
 #          TO               Prod              Cont
 # ----------------------- ----------------------- ----------------
 # Attachments        Attachments        Attachments
 # AttachmentsBRCM        AttachmentBRCM        AttachmentsBRCM
 #
 # You may notice that Prod: AttachmentBRCM is missing the "s".
 # Therefore:
 $field_name = "AttachmentsBRCM" if $field_name eq "AttachmentBRCM";
</pre></div>

<p>Remerging and will run check_attachments again.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 11:55 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000474.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  9, 2005</h2>
                     <a id="a000473"></a>
                     <div class="entry" id="entry-473">
                        <h3 class="entry-header">Removing DBs from a Schema/Email link concerns</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Investigated how to remove databases from a CQ Schema</li>

  <li>Created template files for Clearquest Web Login page to swap in for Phase I and Phase II onto the production web server (under C:\Temp\PQA)</li>

  <li>Discussed the email link problem with Rational. While they can't say definitively what is supported they have stated that the old email link URL will not work in the new schema</li>
<ul>
                              
                              <h2>Databases contained in a Clearquest Schema Database</h2>

<p>A Clearquest connection profile connects to a Clearquest schema database. This schema database defines many things, one of which is which user databases this schema database covers. So with the old 2001 schema all of Prod, TO and NAS is defined in there. The Clearquest Designer has Delete Database and Undelete Database to remove and re-add databases to the schema. This is a misnomer. The schema database has a table, master_dbs, which lists all the user databases that this schema database knows about. What is really happening when you Delete Database is simply that Clearquest Designer is toggling the is_deleted field in master_dbs for this database to 1 meaning it's "deleted". Undelete database merely toggles it back to 0. Being marked deleted means that it will no longer show up as a database to select for Clearquest Windows Clients and the web server. The web server, however, needs to be restarted to notice the change.</p>

<h2>Another Email URL link issue</h2>

<p>With the concept of having multiple Schema repositories and database you are right to be concern about the user being confused when clicking on an email link. Normally the email link is of the format:</p>

<blockquote>
http://<<em>server</em>>/cqweb/url/default.asp?id=<<em>id</em>>
</blockquote>

<p>If the user is logged into CQ Web then they will go directly to the detail defect. If not they will make a brief stop at the login screen. With multiple Schema repositories the user will have to select the proper schema repository and database during login. However you can add on additional parameters to set the default schema repository and database like so:</p>

<blockquote>
http://<<em>server</em>>/cqweb/url/default.asp?id=<<em>id</em>>&dbset=<<em>dbset</em>>&db=<<em>db</em>>
</blockquote>

<p>For example:</p>

<blockquote>
 http://pcsjca-ccrmt03/cqweb/url/default.asp?id=Cont00009460&dbset=2005.02.00&db=Cont
</blockquote>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  3:52 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000473.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  8, 2005</h2>
                     <a id="a000472"></a>
                     <div class="entry" id="entry-472">
                        <h3 class="entry-header">Web Server Configuration and documentation</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Installed Clearquest 2001A.04.00 and verified that it can access Cont</li>

  <li>Figured out how to modify the login page (Clearquest/Web/logon/default_content.asp) and created default_content1.asp and default_content2.asp</li>

  <li>Wrote <a href="http://intranet.broadcom.com/%7Eadefaria/Clearquest/NewCQProfile.php">How to update my Clearquest Profile to access the new Cont database</a>
<ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  7:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000472.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     
                     <a id="a000471"></a>
                     <div class="entry" id="entry-471">
                        <h3 class="entry-header">More on attachments</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Enhanced check_attachments to log better</li>
</ul>
                              
                              <p>Well it's better and didn't take as long as I thought. This time it took 4 hours 34 minutes 49 seconds. Not too bad. And the attachments size is closer. The total attachments for Cont is still &lt; the sum of the attachments from Prod and TO:</p>

<table align="center" border="1" cellpadding="2" cellspacing="0"
 width="75%">
  <tbody>
    <tr>
      <td valign="top">Prod total attachment size<br>
      </td>
      <td align="right" valign="top"> 2,683,569,547</td>
    </tr>
    <tr>
      <td valign="top">TO total attachment size<br>
      </td>
      <td align="right" valign="top"> 272,253,137</td>
    </tr>
    <tr>
      <td valign="top"><b>Total Prod + TO attachment size<br>
      </b></td>
      <td align="right" valign="top"><b> 2,955,822,684</b></td>
    </tr>
    <tr>
      <td valign="top">Cont total attachment size<br>
      </td>
      <td align="right" valign="top"> 2,694,537,318</td>
    </tr>
    <tr>
      <td valign="top"><b>Difference</b><br>
      </td>
      <td align="right" valign="top"><font color="#ff0000"><b>
261,285,366</b></font></td>
    </tr>
  </tbody>
</table>

<p>I'm not sure how to account for that difference.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 10:33 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000471.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">November  7, 2005</h2>
                     <a id="a000470"></a>
                     <div class="entry" id="entry-470">
                        <h3 class="entry-header">check_attachments</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked out a plan for how to perform the PQA Merge this weekend</li>

  <li>Concerned about the size discrepancy in the database I wrote a little utility, check_attachments, to total up the size of all attachments in all the databases. This turned up a bug in pqamerge which I fixed. Reperforming pqamerge</li>

  <li>There is a problem with using clearprompt to prompt for list input for bin_merge - You can only have one line of prompting text and only 50 characters in that line. It's gonna be hard to describe a binary merge situation in 50 characters or less. Investigated making a PerlTk list dialog. In theory it can be done as ccperl does support PerlTk.</li>

  <li>Discussed with Naga the <i>email link</i> issue with PQA</li>
</ul>
                              
                              <h3>TransferAttachments</h3>

<p>I knew there was a good reason why this was eating at me. There is indeed a bug. My attachments transfer routine was not getting called at all for Prod! I wrote a small Perl script to check this and it yielded:<p>

<div class="code"><pre>
$ cqperl check_attachments
Totaling attachments in TO...
Totaling</span> attachments in Prod...
Totaling</span> attachments in Cont...
Total attachment size for TO = 272253137
Total attachment size for Prod = 2683569547
Total attachment size for Cont = 272253137
</pre></div>

<p>Notice that the size of the attachments for TO matches the size of attachments for Cont! IOW no Prod attachments got transferred at all!</p>

<p>Turns out I was only calling TransferAttachments when the field name was AttachmentsBRCM (and TransferAttachments then did all the attachments - both Attachments and AttachmentsBRCM). However, in Prod the field is named AttachmentBRCM - note the
singularity here! I tell ya my eyes are going.</p>

<p>I'm changing my code not be dependent on the field name and to just call TransferAttachments for each record. TransferAttachments doesn't need to know the field name - it just does all of them.</p>

<p>Unfortunately this means that I have to delete all of the records currently in the Cont database on p4test. And it also means that the approximate 4 hour running time will probably increase. However this does explain the discrepancy in the database sizes.</p>

<h3>Out of Disk Space</h3>

Shivdutt Jha wrote:
<blockquote type=cite>
Good job Andrew, another mystery is solved.
</blockquote>

<p>What is more telling is that we have 2.6 Gig of attachments!</p>

<p>In any event my merge failed with out of disk space. The pqamerge script uses the current directory to temporarily hold the attachments as the are transfered from one DB to the other. Turns out that Prod00010818 has two very large attachments, one 328485466 bytes and another 219095209 bytes. Unfortunately I was running in ~vobadm/My Documents and that disk filled. So another lesson learned - run pqamerge in a directory on a disk with lots of disk space! Alas this means I have to start this process over again (I'm trying to get a clean run and a timing of how long to expect the merge to run. pqamerge outputs how long it takes to do it work).</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:54 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000470.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
