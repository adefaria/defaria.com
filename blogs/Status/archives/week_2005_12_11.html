<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: December 11, 2005 - December 17, 2005 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2005_12_04.html" title="December  4, 2005 - December 10, 2005" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2005_12_18.html" title="December 18, 2005 - December 24, 2005" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2005_12_04.html">&laquo; December  4, 2005 - December 10, 2005</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2005_12_18.html">December 18, 2005 - December 24, 2005 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">December 15, 2005</h2>
                     <a id="a000498"></a>
                     <div class="entry" id="entry-498">
                        <h3 class="entry-header">CQ Web/Rebase/GNATS Access</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Set up GNATS access for a user</li>

  <li>Helped Vinh with issues regarding old CQ Web and a bug that it has</li>

  <li>Assisted a few users with resolving Evil Twin problems</li>

  <li>More fully documented how to resolve Evil Twin problems by merging the parent directory</li>

  <lI>Investigated implementing the other half of BinMerge where we use rebase instead of find merge</li>
</ul>
                              
                              <h2>Rebase</h2>

<p>Initially I thought that rebase did not work like findmerge in that it didn't have options for performing essentially the merge operate and just telling you what needed to merge. Turns out it does have that option - cleartool merge -preview -long. The long option causes rebase to list out what needs to be merged.</p>

<p>But rebase is more than just a findmerge. Additionally one needs to do the following:</p>

  <ul>
    <li>Create and set an activity for the view</li>

    <li>Check out items first</li>

    <li>Perform the merge with -abort noting which merges failed and how they failed</li>

    <li>Execute the rebase command to mark the view as being rebased</li>

    <li>Execute the rebase -complete to mark the rebase completed (IFF all elements are rebased)</li>
  </ul>

<p>Of course this is just a preliminary list - we still need to figure out if rebasing, merging actually, of directories need to be done first (probably), how to execute rebase to mark "rebase in progress" without actually attempting to merge anything, etc.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:06 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000498.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">December 14, 2005</h2>
                     <a id="a000497"></a>
                     <div class="entry" id="entry-497">
                        <h3 class="entry-header">get_views_for_stream/create_dev_snapview.pl</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Found and fixed bug in get_views_for_stream</li>

  <li>Fixed bug in create_dev_snapview.pl::ParseBaselines
</ul>
                              
                              <h2>get_views_for_stream</h2>

<p>Hi Naga. I'm writing you this because I believe there's a bug, possibly with Clearcase, but that seems to manifest itself in code I believe you wrote. I came across this implementing enhancements to create_dev_snapview.pl for Andrew Feltham. In essence Andrew wants to be able to have multiple views in a stream. I've implemented a -reuse_stream parm to allow this. If -reuse_stream is used then the code will skip recreating the stream and effectively just make another view in that same stream. If -reuse_stream is not specified then the stream is removed - along with any views that that stream has.</p>

<p>It appears as if the code was coded to attempt to handle the case where a stream has multiple views however it fails due to a possible but with lsstream. When calling create_stream the code checks to see if the stream exists and if it does it attempts to recreate the stream by determining the view(s) in the stream, deleting them, deleting the stream and creating the stream anew.</p>

<p>To determine the view(s) in the stream get_views_for_stream is called. Here's the original function:</p>

<div class="code"><pre>
sub get_views_for_stream {
    my $sel_pvob = $_[0];
    my $sel_stream = $_[1];

    my @views = split(/\n/, `cleartool lsstream -fmt \"\%\[views\]p\\n\" stream:$sel_stream\@\\$sel_pvob`);
    return @views;
}
</pre></div>

<p>Essentially it does an lsstream asking for only the views, separated by newlines. The problem is that lsstream (with that format) does not return the views separated by newlines:</p>

<div class="code"><pre>
P:\>cleartool lsstream -fmt "%[views]p\n" stream:Build_rmnaNT_adefaria_LTSJCA-ADEFARIA_sv_ldx_2.3@\rmna_projects
adefaria_test adefaria_test2 adefaria_test3

P:\>
</pre></div>

<p>As you can see adefaria_test, adefaria_test2 and adefaria_test3 all appear on the same line. The code then splits the line on \n and effectively always returns a 1 entry array with possibly multiple view names in the first entry separated by spaces. Needless to say this will fail later on when remove_view is called and it generates a "cleartool rmview -force &lt;view names&gt;".</p>

<p>Here's my proposed fix:</p>

<div class="code"><pre>
sub get_views_for_stream {
    my $sel_pvob = $_[0];
    my $sel_stream = $_[1];
    # Modified Wed Dec 14 11:25:09 PST 2005 Andrew@DeFaria.com
    #
    # Note: The format -fmt "%[views]p\n" below does not work! What is
    # expected to be returned is:
    #
    # view1
    # view2
    # view3
    #
    # However what is actually returned is:
    #
    # view1 view2 view3
    #
    # Therefore the old spilt of /\n/ always returned a single entry
    # array with possibly multiple view names in the first
    # entry. Changed to use / / for split and not append a \n.
    my @views = split(/ /, `cleartool lsstream -fmt \"\%\[views\]p\" stream:$sel_stream\@\\$sel_pvob`);
    return @views;
}
</pre></div>

<p>Is this acceptable to you?</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  1:48 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000497.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">December 13, 2005</h2>
                     <a id="a000496"></a>
                     <div class="entry" id="entry-496">
                        <h3 class="entry-header">cvsims</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Updated triggers on ccase-rmna-3 as some new vobs seem to lack them</li>

  <li>Updated cvsims to parse input and handle both -pre and -post operations</li>

  <li>Had problems with CVS admin files</li>
</ul>
                              
                              <h2>CVSIMS</h2>

<p>I have managed to learn how to update IMS and I'm at the point where I need to understand the input requirements better. I will describe what I envision happening and follow it with a few questions.</p>

<p>In general the desire seems to be to update IMS when a commit happens in certain CVS repositories<a href="#q1"><sup>1</sup></a>. As such commit comment information will need to conform to a certain format. Commit comments need to have the following in them identifying the IMS Issue ID they are associated with:</p>

<div class="code"><pre>
IMSIssueID: &lt;issue ID&gt;
</pre></div>

<h3>Pre-commit checks (i.e. verifymsg)</h3>

<p>The string "IMSIssueID: " must appear at the start of a line followed by the issue ID<a href="#q2"><sup>2</sup></a>. The IMSIssueID must exist in IMS<a href="#q3"><sup>3</sup></a>. If the issue ID is not in IMS then the commit will not be allowed. Commits lacking any IMSIssueID will be rejected<a href="#q4"><sup>4</sup></a>.</p>

<h3>Post-commit operations (i.e. loginfo)</h3>

<p>If the pre-commit checks pass the IMS issue will have it's change set field updated with the file names of the committed files. As change set is an append only field the following separator will be added first followed by the list of files<a href="#q5"><sup>5</sup></a>:</p>

<div class="code"><pre>
# &lt;USERNAME&gt; &lt;DATE_TIME&gt; committed:
file1
file2
...
</pre></div>

<p>Again, as change set is an append only field there may be multiple updates like so:</p>

<div class="code"><pre>
# &lt;USERNAME&gt; &lt;DATE_TIME&gt; committed:
file1
file2
...
# &lt;USERNAME&gt; &lt;DATE_TIME&gt; committed:
file10
</pre></div>

<h3>Questions</h3>
<ol>
  <li><a name="q1"></a>Which repositories does this apply?</li>

  <li><a name="q2"></a>Are multiple IMSIssueIDs allowed? If so then are multiple lines such
as the above acceptable or should the script search for perhaps a comma separated list of issue IDs?</li>

  <li><a name="q3"></a>Should the script also check to insure that the issue ID is not in say a closed state?</li>

  <li><a name="q4"></a>Is it true that all commits in a repository/module/directory <b>must</b> be associated to an IMS Issue?</li>

  <li><a name="q5"></a>In addition to the file name should we include the revision checked in? Also should any other information be logged (e.g. repository)?</li>
</ol>

<h2>CVS Admin Files</h2>

<p>I got myself into a pickle. Here's what I was doing...</p>

<p>I wanted to modify <span>rcsinfo, verifymsg and loginfo
in our CVS test area (:pserver:adefaria@cvsps-irva-1:/projects/ccase_irva/cvsmaster)
so I checked out CVSROOT and modified those files. The idea was to have rcsinfo point to a template file so the user knows where to put the IMSIssueID, change verifymsg to call cvsism
(the connector) to verify that it can find the IssueID and that the IssueID exists in IMS and change loginfo to call cvsism to update the change set after the commit. Unfortunately I modified the files in such a way that I cannot check in at all. I need help in fixing this because I believe what needs to be done needs to be done on the server and I don't have a login there let alone root access.</p>

<p>The problem is that I don't understand what the cwd is when CVS fires off these triggers. For example, in rcsinfo I have the following line:</p>

<div class="code"><pre>
ALL /tmp/IMSIssueTemplate
</pre></div>

<p>"ALL" means for all files and /tmp/IMSIssueTemplate is the template file. But where is /tmp? Is it supposed to be on the server? Where's a good place to put these template files?</p>

<p>In verifymsg I have:</p>

<div class="code"><pre>
DEFAULT SCM/cvsbin/cvsims -pre
</pre></div>

<p>I want to run cvsims (which is in my home directory under SCM/cvsbin) but this also fails.
As a result of this I cannot use cvs commit to change verifymsg, hence I'm stuck!</p>

<p>In <span>loginfo</span> I have:</p>

<div class="code"><pre>
DEFAULT SCM/cvsbin/cvsims -post %{s}
</pre></div>

<p>Again SCM/cvsbin/cvsims is not a valid path.</p>

<p>How can I get this fixed? Where should I put these files?</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:35 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000496.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">December 12, 2005</h2>
                     <a id="a000495"></a>
                     <div class="entry" id="entry-495">
                        <h3 class="entry-header">mktriggers/CVS</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Worked with Shivdutt on clearfsimport</li>

  <li>Updated mktriggers to use fully qualified paths to Perl</li>

  <li>Added stuff to CVS area - have not committed yet - wanna establish a commitinfo script to get an idea of what input is available to commit</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:14 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000495.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
