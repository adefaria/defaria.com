<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: April  9, 2006 - April 15, 2006 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2006_04_02.html" title="April  2, 2006 - April  8, 2006" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2006_04_16.html" title="April 16, 2006 - April 22, 2006" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2006_04_02.html">&laquo; April  2, 2006 - April  8, 2006</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2006_04_16.html">April 16, 2006 - April 22, 2006 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">April 15, 2006</h2>
                     <a id="a000541"></a>
                     <div class="entry" id="entry-541">
                        <h3 class="entry-header">Production User Database Migrated</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Managed to migrate the production user database</li>

  <li>Clearquest desktop users need to upgrade their software. Meantime they can use the web interface</li>

  <li>Verified cqd and triggers work</li>

  <li>Documented how to switch a desktop to the new server</li>

  <li>Documented how to build on the new server</li>
</ul>

<p><b>Time Spent:</b> 4 Hours</p>
                              
                              <h2>Production User Database Migrated!</h2>

<p>More progress in this area.</p>

<p>I decided to try to use the Sybase Central tool to see if I could
verify or otherwise fix this potentially bad database. I also looked at
running Chkdisk as the eventlog was reporting some bad sectors on the
disk. Unfortunately chkdisk cannot fully check the disk since the
database is on the C drive and the C drive is currently busy. Normally
you just set a flag and chkdisk will run after next boot. But such a
chkdisk will take a long time on a big disk.</p>

<p>Meantime in Sybase Central I decide to do fresh backups of the
databases which seem to go OK. These backup databases look no different
really than the regular databases so I run validate on the backup
database. Hmmm.... Doesn't seem to have any errors. So I tried the
installutil copyuserdb to copy the <b>backup</b> database <b>as if is
was the real production database</b> to the new server. Hmmm.... That
worked!</p>

<p>Next I had to go into Clearquest Maintenance Tool and select Schema
Respository: Upgrade: Selected Connection and upgrade the production
user database. That worked!</p>

<p>I checked the Clearquest web (<a href="http://sons-sc-cc/cqweb/login">http://sons-sc-cc/cqweb/login</a>) and the
new database is indeed there and working!</p>

<h2>Clearquest Desktop Clients Need to Upgrade</h2>

<p><font color="#ff0000"><b>Problem:</b> Clearquest 2002.05.00 desktop
clients cannot access this new database!</font></p>

<p>I tried creating a connection profile to this new database and then
importing it on the old server running 2002.05.00.This did not work!
Later I read in the Rational Suite Migration Guide:</p>

<blockquote>Your network environement can contain misxed versions of
ClearCase and ClearQuest clients (where some clients are at v2003 and
some clients are at ealier versions) if these products are in a
standalone environment, that is:</p>
<p></p>
....
<p></p>

<p>If your vendor database is SQL Anywhere, you do not plan to upgrade to
SQL Anywhere 8.0 until all ClearQuest clients and databases have been
upgraded to version 2003.</p>
</blockquote>

<p>So we'll have to upgrade desktop clients to 2003.06.00! Luckily people
can use the Clearquest Web Client...</p>

<h2>Clearquest Daemon Works with Minor Tweaks</h2>

<p>Checked that cqd and cqc work with the new server. All that need to be
changed is to change the default server from sons-clearcase -&gt;
sons-sc-cc in cqc.pm.</p>

<h2>Checked and Triggers Work in New Environment</h2>

<p>I was able to check to see that the triggers function in the new
environment.</p>

<h2>Switching Your Desktop to the New Server</h2>

<p>Use the following steps switch your desktop to the new server:</p>

<ol>
  <li>Stop all Clearcase activity. Close any Clearcase Explorer windows
and any shells in Clearcase views.</li>
  <li>In a Cygwin shell type ct umount -all to unmount all vobs.</li>
  <li>Go to Control Panel: Clearcase</li>
  <li>Click on the Services tab then Stop Clearcase</li>
  <li>Click OK to the dialog saying Clearcase has stopped</li>
  <li>Click OK to <b>close</b> the Clearcase Control Panel Applet</li>
  <li>Start the Clearcase Control Panel <b>again</b></li>
  <li>On the registry tag, change the registry server to sons-sc-cc</li>
  <li>Click OK to close the Clearcase Control Panel <b>again</b></li>
  <li>On the Registry tab click the drop down arrow for Windows Region.
You should see the new SC region. Select it.</li>
  <li>Click on <b>Apply</b></li>
  <li>Click on the Services Startup tab and then Start Clearcase</li>
  <li>Close the Clearcase Control Panel</li>
  <li>Start a Cygwin shell and type ct hostinfo -l. You should see
something like:<br>
    <br>
<div class=code><pre>
<font color="blue"><b>[ccadmin] adefaria:</b></font><u>ct hostinfo -l</u>
Client: adefaria
  Product: ClearCase 2002.05.00+
  Operating system: Windows NT 5.1 (build 2600) Service Pack 2
  Hardware type: Pentium
  Registry host: <b>sons-sc-cc</b>
  Registry region: <b>SC</b>
  License host: sons-clearcase
</pre></div>

    <p>As you can see we are now pointing to the sons-sc-cc registry
host and the SC region. Sons-clearcase is still the license server at
this time. Type ct lsview and you should see:</p>

<div class="code"><pre>
<font color="blue"><b>[ccadmin] adefaria:</b></font><u>ct lsview</u>
  official             \\sons-sc-cc\Views\SALIRA\ccadmin\official.vws
  3.1.ccadmin     \\sons-sc-cc\Views\SALIRA\ccadmin\3.1.ccadmin.vws
  szhu_view_2     \\sons-sc-cc\Views\SALIRA\szhu\szhu_view_2.vws
    </pre></div>

    <p>A noticeably smaller list of views that are on sons-sc-cc in
the SC region</li>
</ol>

<p>Follow a similar set of steps to switch back to the old registry server
(sons-clearcase) and region (US). No reboots required (provided you
properly stop Clearcase and do things like get out of views and umount
vobs).</p>

<h2>Attempting an Official Build on sons-sc-cc</h2>

<p>This procedure can be done either by following the procedure above to
switch your desktop to the new server or simply use rsh/telnet to log
into sons-sc-cc. Once there:</p>

<ol>
  <li>Make user that the 3.1.ccadmin view is started<br>
<div class=code><pre>
$ ct startview 3.1.ccadmin
</pre></div></li>
  <li>Make sure the salira vob is mounted:<br>
    <br>
<div class=code><pre>
$ ct mount \\salira
</pre></div></li>
  <li>Change directory to the build area:<br>
    <br>
<div class=code><pre>
$ cd /dview/3.1.ccadmin/salira/neopon/build
</pre></div></li>
  <li>Type make:<br>
<div class=code><pre>
$ make
</pre></div></li>
</ol>

                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:55 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000541.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">April 12, 2006</h2>
                     <a id="a000540"></a>
                     <div class="entry" id="entry-540">
                        <h3 class="entry-header">More fun with SQL ANYWHERE</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <h3>Attempting to transfer databases using MS Access</h3>

<p>OK, trying this methodology:</p>

<ul>
  <li>Used installutil copyschemarepo command to copy schema.db -&gt;
schema.mdb</li>
  <li>Moved schema.mdb to new server</li>
  <li>Used installutil copyuserdb command to copy salira_test.db -&gt;
test.db.</li>
  <li>Moved test.db to new server</li>
  <li>Tried several times to use installutil command to copy
salira_bugs.db (the production database) -&gt; bugs2.db. System aborted
several times. Not sure if this is due to bad disk blocks or not. This
is a major problem as this is the data we care about.</li>
</ul>

<p>Back on the new server:</p>

<ul>
  <li>If I do Connection: New and point to the schema.mdb file it wants
to overwrite it! Instead I did File: Import Profile of a profile of the
old databases. Of course these say SQL_ANYWHERE. I change this to
MS_ACCESS and point to the schema.mdb file and this seems to work.</li>
  <li>Attempt to do Schema Repository: Move. In doing so I set the
Physical Database Name by browsing to the folder via the ellipsis
button. This leaves me with D:\Clearquest\schema.db. Clicking on Finish
give ms:<br>
    <blockquote>The filename you have specified is not a Share. If
other users will need access to this database, you should browse
through "Network Neighborhood" to place is in a share. Continue with
this name?<br>
    </blockquote>
I select No because I do want other users to be able to access this
database. Next I change the D:\Clearquest\salira.db -&gt;
\\sons-sc-cc\Clearquest\schema.db and click Finish. At this point I get
a error dialog stating that it was "Unable to connect to the database
server". After much scratching of the head I realize that I should use
D:\Clearquest\schema.db, ignore the warning, then go back in and set
the Physical Database Name to \\sons-sc-cc\Clearquest\schema.db.<br>
    <br>
Oh, a side issue: After failing using a Physical Database Name of
\\sons-sc-cc\Clearquest\schema.db the Rational Clearquest Maintenance
Tool still creates a schema.db file. If you go Back and correct the
Physical Database Name to a local path and click Finish you'll get a
database I/O error. Turns out you have to remove this schema.db file
first. These two (what else could I call them but) BUGS caused me to
lose many hours of sleep.<br>
    <br>
Managed to move the schema.mdb -&gt; schema.db.</li>
  <li>Switching to the Clearquest Designer now to Database: Update User
Database Properties. As I only have the test.mdb file to convert I
change the user database properties for the test database.</li>
  <li>Now I select Database: Move User Database to move the test user
database to SQL_ANYWHERE</li>
</ul>

<p>At this point I'd like to run Clearquest Designer and do Test Work so I
can at at least verify that I can access the converted to SQL_ANYWHERE
test.db. Unfortunately there is a checked out version of the schema in
the schema database that I copied over and I'm not the owner of that
checked out schema. And I can't login as that user.</p>

<p>By chance I tried Schema Repository: Upgrade: Selected connection in
the Clearquest Maintenance Tool and in stepping through those dialog
boxes it say "The schema repository that you want to upgrade has
checked-out schemas. If you continue the upgrade process, the checked
out schema versions cannot be upgraded and will be deleted from the
system". I continue onward and manage to "upgrade" the schema and test
database. I proceed into Clearquest Designer and manage to Test Work
and viola! I got it up. I am nothing if not tenacious!</p>

<p><b>Total Time:</b> 2 hours</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 10:50 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000540.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">April 11, 2006</h2>
                     <a id="a000539"></a>
                     <div class="entry" id="entry-539">
                        <h3 class="entry-header">Build bugs, Test suite still not runing nightly</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Fixed bug with saving test.log where I was attempting to save it before I returned from the subroutine. We now save the test.log even if test suite is successful. This is good because continuous building reuses the view area thus destroying any test.logs created before.</li>

  <li>Fixed bug in build::CheckForShutdown where we called LogEvent without a $log parameter. This caused CheckForShutdown to abort the build while in CIT daemon mode and thus we didn't see the error. It also left the shutdown file thus subsequent starts merely shutdown (actually aborted) until one manually removed the shutdown file. Bad bug! Bad, bad!</li>

  <li>Looking into why the test suite works when called at the Build.pl level but fails when called from the streamBuild.pl level.</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:15 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000539.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     
                     <a id="a000538"></a>
                     <div class="entry" id="entry-538">
                        <h3 class="entry-header">More SQL Anywhere Wrestling</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Installed SQL Anywhere 8.0.3 Patch to fix problem with Services folder not appearing in Sybase Central</li>

  <li>Spent time trying to figure out how to get a service configured. Eventually figured out that I need to specify -n &lt;<i>machine</i>&gt; as part of the parms or starting the service would just hang</li>

  <li>Instructions given from Rational spoke of converting databases on a single server. This is not what we are doing there. Tried various things in an attempt to extend the directions to two servers and get the installutil command to run. Nothing was working.</li>

  <li>Scoured the Rational documents and the net for "preparedbforupgrade" - turned up little except some guys personal web site talking about how the <i>Rational Suite - Upgrade Guide</i> describes the upgrade procedure with two servers and here's the single server procedure. That's nice, and it's pretty much the exact technote that the Rational support engineer pointed me to. However where's the double server procedure!</li>

  <li>Scoured the Rational site, this time for <i>Rational Suite - Upgrade Guide</i>. Found it! It was a in a pdf file! Apparently the Rational site search engine doesn't search inside pdf files. They should take a lesson from Google! Also searched the system for this pdf file (rs_upgrade.pdf) and it was not on the system. Now why isn't it part of what gets installed?</li>

  <li>Started doing the steps for converting the database as described in the <i>Rational Suite - Upgrade Guide</i>. See below for more.</li>
</ul>

<p><b>Time Spent:</b> 4 hours</p>
                              
                              <h3>Still issues with SQL Anywhere upgrade</h3>

<p>According to the <i>Rational Suite - Upgrade Guide</i> I need to import the connection profile from the SQL Anywhere 5.0 server then update it to add on the new SERVER_VER connection option (I believe I need to specify SERVER_VER=8.0.3 since I've now patched to 8.0.3) then save that connection profile. If I change the database server name to the new name but leave the Physical Database Name pointing to the old server then I get an error. If I change the database server name and point the Physical Database Name to a copy of the schema.db on the new server I can't connect either. If I leave those pointing to the old server and only add on the SERVER_VER parm then the connection updates. But now access to Clearquest fails on the old server complaining that SERVER_VER is invalid! How are you supposed to do this?!? Step by step instructions would be great!</p>

<p>Even if I were to be able to get the above done I would hesitant to perform the next step because it describes using the Clearquest Maintainance Tool to <b>move</b> the schema and user databases!</p>

<blockquote>
Move your schema repository. In the ClearQuest Maintenance Tool, in the <strong>Existing Connections</strong> area, select the connection to your existing SQL Anywhere 5.0 databases, then click <strong>Schema Repository > Move</strong>. Enter database information for a new database under your SQL Anywhere 8.0 server. For example, enter a different filename in the same directory as the existing
database. Click <strong>Finish</strong>.
</blockquote>
<p>I don't want to <b>move</b> databases - I want to simply <b>copy</b> them. Moving them would mean that current production would have to halt until I got it back up and running on the new server.
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:37 AM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000538.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">April 10, 2006</h2>
                     <a id="a000537"></a>
                     <div class="entry" id="entry-537">
                        <h3 class="entry-header">Save the logfiles! IFrames</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Changed the build process to save the test logfile</li>

  <li>Changed the build_status to use an iframe for the continuous log file</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  6:49 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000537.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                     

                     <h2 class="date-header">April  9, 2006</h2>
                     <a id="a000535"></a>
                     <div class="entry" id="entry-535">
                        <h3 class="entry-header">SQL Anywhere</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Attempted to migrate Clearquest databases to new server. I was unable to. I've opened up a PMR with IBM Rational #8552849R and expect to get email from them tomorrow.</li>

  <li>Attempting to switch the machine adefaria over to this newly created registry server (sons-sc-cc). Decided to reboot the machine. It never came back up! If you can boot this machine that would be great. You might need to go into the Clearcase Control Panel and set the registry server back to sons-clearcase and set the region to US. It might require a reboot to be effective. Why, when I rebooted it, it failed to come back up?</li>
</ul>

<p><b>Time Spent:</b> 4 hours</p>
                              
                              <h2>Migrating databases to new SQLAnywhere 8.x</h2>

<p>Spent most of the day banging against SQL Anywhere. We need to migrate the databases (both the schema.db and the salira_bugs.db) to the new server. With the new server comes new DBMS software (Sorry but SQL Anywhere 5.5.05 which is what you have on sons-clearcase is being sunsetted anyway).</p>

<p>Now I've done some extensive Clearquest work over at <a href="http://defaria.com/blogs/Status/archives/cat_pqa.html">Broadcom</a> it was all MS SQL based in the back end.</p>

<p>The first problem I have is that there is not service for SQL Anywhere like there used to be over on sons-clearcase. I managed to find C:\Program Files\Rational\SQLAnywhere8\win32\dbeng8.exe and dbsrv8.exe and that appears to be the process to start, there still isn't any automatically starting service for SQL Anywhere 8. That plus when run it prompts with a dialog box that queries about the database to use. I was always under the impression that a DBMS server just runs for any and all databases on the machine. I can just specify the server and leave the database blank but other times when running Sybase Central it complains that it can't start the DB server.</p>

<p>I thought that I could simply use Sybase Central to backup the databases on sons-clearcase then use the restore function of Sybase Central on sons-sc-cc. There are also options like Migrate Database, etc. to deal with differences in databases between old and new versions of SQL Anywhere. All of these had problems for me...</p>

<h2>Backup/Restore</h2>

<p>I backed up the salira_bugs.db file over to \\sons-sc-cc\Clearquest\backup\salira_bugs.db. Next I attempted to restore it on sons-sc-cc I get "Unable to start database server".</p>

<h2>Connect to backup database</h2>

<p>When I attempt to simply connect to that db I get:</p>

<blockquote>
  <p>You are attempting to connect to a version 5.5.03 database running on a version 8.0.2-3601 server. In order for the Sybase Central to use this database, the database must be unloaded and reloaded into a new database (Sybase Central only supports version 7.0.0 and later database). The Unload Database wizard can step you through this process, after which Sybase Central will diconnect from this database.</p>

  <p>Do you want to unload and reload this database? (If not, Sybase Central will disconnect from this database now.)</p>
</blockquote>

<p>If I step through this wizard I eventually get:</p>

<div class=code><pre>
java.lang.UnsatisfiedLinkError: unloadDatabase
Could not unload the database 'salira_bugs'.
</pre></div>

<h2>Migrate Database</h2>

<p>If I attempt to Migrate Database I get a message saying "You must be connected to the database to which you want to migrate" which, of course, I can't...</p>

<h2>Creating and Erase Database</h2>

<p>I have not managed to create a database through Sybase Central (but I have been able to create it through Clearquest Maintainance Tool and the Clearquest Designer - see below). When I try I get: Unable to start database server.</p>

<p>For databases created via Clearquest tools I cannot erase them using Erase database. Instead I get the same thing: Unable to start database server. So far when I need to delete a database I merely remove the databse files themselves.</p>

<p>I can create a schema database and even user databases through the Clearcase Maintainance Tool and Clearquest Designer respectively. But we don't want a new schema nor empty user databases - we want to migrate the old scheme that has our modifications and we want to migrate our old database!</p>

<h2>Moving Databases</h2>

<p>There's also an option to move a database from one server to another. Now I don't want to move databases right yet - I want to copy them. However this move seems to copy the database and then lock the original database. So I tried it out on the test2 database. Effectively you go into the Clearquest Designer on sons-clearcase and then select Database: Move Database then go through the dialog box specifying that you want to move the database over to sons-sc-cc. That works and test2.db does appear over on sons-sc-cc. But when I attempt to connect to it Sybase Central again goes through the unload/load procedure which fails the same way as described above.</p>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  7:07 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000535.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
