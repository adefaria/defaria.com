<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: June 18, 2006 - June 24, 2006 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2006_05_28.html" title="May 28, 2006 - June  3, 2006" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2006_06_25.html" title="June 25, 2006 - July  1, 2006" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2006_05_28.html">&laquo; May 28, 2006 - June  3, 2006</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2006_06_25.html">June 25, 2006 - July  1, 2006 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">June 22, 2006</h2>
                     <a id="a000555"></a>
                     <div class="entry" id="entry-555">
                        <h3 class="entry-header">Vob corruption/Email/Chmaster</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Fixed problem with email from Multisite jobs</li>

  <li>Investigated vob corruption</li>

  <li>Looked into chmaster</li>
</ul>

<p><b>Total time:</b> 5 hours</b></p>
                              
                              <h3>Email server for Multisite messages</h3>

<p>Multisite needs to send email if there is a problem with synchronization. The setting for which SMTP server to use is in the Clearcase Control Panel under Advanced. Somehow that got set to sons-exch02 which is no longer a valid SMTP server. Changed this to sons-exch01.</p>

<h3>Database identifier not found when doing syncreplica import</h3>

<p>Dear IBM/Rational Tech Support: My name is Andrew DeFaria and I perform
Clearcase/Clearquest consultant services. One of my clients, Salira Optical Network Systems (a former employer of mine), has been experiencing a problem, described below, and has asked me to look into it for them. They are also in the process of migrating to newer server hardware and migrating up to the latest version of Clearcase/Clearquest. I've been performing this migration. So far we have the new server up and have Multisite replicating things between 3 "sites" - a remote one in Shanghai (sons-cc) and two in Santa Clara: the old server (sons-clearcase) and the new server (sons-sc-cc).</p>

<p>I had been working on this problem for a while last night. I was seeing what you guys were seeing - the db_server process will be running wildly and taking up 50% of the CPU. This seems to happen whenever the scheduled syncreplica -import runs on sons-clearcase. As a result sons-clearcase is not being synced. As far as I can tell this syncreplica -import never finishes and the db_server process consumes 50% of the CPU until killed.</p>

<p>I've also seen several of the following error in the db_server log:</p>

<div class=code><pre>
Database identifer &lt;x&gt; not found in "..db__obj.c" line 731
</pre></div>

<p>While the line number remains the same the id's I've seen are 427883, 427919, 427922.</p>

<p>Thinking that this was some sort of vob database corruption I ran checkvob and it reported some minor missing references to source containers. I then ran it in fix mode which cleared up the missing source containers but the missing db identifiers remain.</p>

<p>Next I tried running recoverpacket hoping to set the epoch numbers back a few days and thinking maybe the syncreplica would repair itself. On sons-sc-cc (SantaClara replica) I issued the following command:</p>

<div class=code><pre>
[ccadmin] sons-sc-cc:mt recoverpacket -since 20-Jun-05 SantaClara@\salira
Using epoch information from Monday, June 19, 2006 11:00:03 Pm
Epoch row for replica "US" successfully reset
</pre></div>

<p>Then back on sons-clearcase (US replica) I issued:</p>

<div class=code><pre>
[ccadmin] sons-clearcase:mt syncreplica -export -fship SantaClara@\salira
</pre></div>

<p>This went on to create a huge packet (growing over 1 gig!) before the scheduled syncreplica -import starts and ties up the db_server process.</p>

<p>Searching IBM/Rational support the closest thing I see is <a href="http://www-1.ibm.com/support/docview.wss?rs=100&amp;q1=database+identifier+not+found&amp;uid=swg21238768&amp;loc=en_US&amp;cs=utf-8&amp;lang=en">multitool syncreplica -export fails with Database identifier 0 not found in "../db__ver.c" line 505</a>. I know this speaks of syncreplica -export and references db__ver.c not db__obj.c it is the closest problem report that I could find. And it has the onerous note of:</p>

<blockquote>
<b>Note: </b>This defect may also occur in <a href="http://www-1.ibm.com/support/docview.wss?rs=984&amp;uid=swg21137780"
 target="_blank">ClearCase MultiSite 2002.05 (5.0)</a>, however, the fix will not be back patched, you either need to back out of the patch that introduced this, or upgrade to a later version of ClearCase MultiSite to recover.
</blockquote>

<p>The clearcase version on sons-clearcase is:</p>

<div class=code><pre>
[ccadmin] sons-clearcase:ct -ver
ClearCase version 2002.05.00 (Tue Oct 30 08:27:59 2001)
clearcase patch p2002.05.00 NT-8 (Mon Jun 10 14:44:04 2002)
clearcase patch p2002.05.00 NT-12 (Thu Sep 12 11:15:10 2002)
@(#) MVFS version 2002.05.00+ (May 25 2002 03:14:49)
cleartool                         2002.05.00 (Fri Oct 26 20:24:09  2001)
db_server                         2002.05.00+ (Fri Aug 30 11:48:28 2002)
</pre></div>

<p>As I said, we are in the process of migrating to 2003.06 and we are already halfway there - however, at this point people have not yet fully migrated their views over to the new server and the old server still serves Clearcase licenses.</p>

<p>Finally, as I am only a part time consultant at Salira you may wish to contact Jeff Stribling (408-845-5200) directly to gather more info and possibly try some solutions. My contact information is at <a href="http://defaria.com/contact.php">http://defaria.com/contact.php</a> but realize that during the day I'm at another client.</p>

<h3>Chmaster</h3>

<p>There are a few Clearcase objects that can have mastership. These are:</p>

<ol>
  <li>Label types</li>

  <li>Branch types</li>

  <li>Trigger types</li>

  <li>Hyperlink types</li>

  <li>Attribute types</li>

  <li>Element types</li>
</ol>

<p>1 &amp; 2 above are the ones that concern me and that need to eventually get transfered. #3 has already been done by my mktriggers script with added the triggers to the vobs over on sons-sc-cc long ago.#4, 5 and 6 Salira doesn't really use anyway (there are only the predefined types for 4, 5 and 6 anyway).</p>

<p>It might be good for you, or perhaps Vijay, to experiment a bit on changing the mastership of a branch type, a branch that is not heavily used. I would:</p>

<ul>
  <li>Set up a new view on sons-sc-cc oriented to working on this test branch that is mastered by sons-clearcase</li>

  <li>Verify that there is a problem and how it manifests itself attempting to use this view on sons-sc-cc. IOW, while working on this new view on sons-sc-cc verify that you cannot checkout to this test branch because it's mastered at  sons-clearcase</li>

  <li>Transfer mastership of this test branch over to sons-sc-cc</li>

  <li>Test that the problem has gone away</li>
</ul>

<p>Of course I realize that the overriding problem is the current vob database problem on sons-clearcase described in my earlier email. Assuming that that's fixed and multisiting is working...</p>

<p>You can see these types by right clicking on the vob in the Clearcase Explorer on sons-clearcase and selected Explore Types. You can double click on branch type and find your test branch. Right click on it and select properties. Go to the Mastership tab and click on Change. Select SantaClara (that's sons-sc-cc). You might need to also perform a syncreplica (run the scheduled job for sync export on sons-clearcase and the sync import on sons-sc-cc.</p>

<p>There are about 30 branch types that are mastered on sons-clearcase. There are far more label types that are mastered on sons-clearcase. IOW while I might change mastership by hand for the 30 or so branch types, I wouldn't want to  change mastership for all those labels.</p>

<p>What I have not verified is what happens if one was working on sons-sc-cc, checks in a bug and the trigger attempts to move that pre existing label (this was an update to an old bug) to point to the new version about to be checked in. Since that label is mastered by sons-clearcase will that be a problem?</p>

<p>If your test above regarding changing the mastership of a test branch type is successful you may wish to move a more used branch type's mastership in the same manner then instructed the engineers involved in that branch to move to the new server. Then the next branch type, etc.
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at  5:59 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000555.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
