<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="generator" content="Movable Type 5.2.3" />

   <link rel="stylesheet" href="http://defaria.com/blogs/Status/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="http://defaria.com/blogs/Status/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://defaria.com/blogs/Status/index.xml"$>" />

   <title>Status for Andrew DeFaria: November  5, 2006 - November 11, 2006 Archives</title>

   <link rel="start" href="http://defaria.com/blogs/Status/" title="Home" />
   <link rel="prev" href="http://defaria.com/blogs/Status/archives/week_2006_10_29.html" title="October 29, 2006 - November  4, 2006" />
   <link rel="next" href="http://defaria.com/blogs/Status/archives/week_2006_11_12.html" title="November 12, 2006 - November 18, 2006" />
</head>
<body class="layout-one-column">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="http://defaria.com/blogs/Status/" accesskey="1">Status for Andrew DeFaria</a></h1>
               <h2 id="banner-description">Searchable status reports and work log</h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">
                     
                     <p class="content-nav">
                        <a href="http://defaria.com/blogs/Status/archives/week_2006_10_29.html">&laquo; October 29, 2006 - November  4, 2006</a> |
                        <a href="http://defaria.com/blogs/Status/">Main</a>
                        | <a href="http://defaria.com/blogs/Status/archives/week_2006_11_12.html">November 12, 2006 - November 18, 2006 &raquo;</a>
                     </p>
                     
                     
                     

                     <h2 class="date-header">November  7, 2006</h2>
                     <a id="a000590"></a>
                     <div class="entry" id="entry-590">
                        <h3 class="entry-header">UK -> GPDB</h3>
                        <div class="entry-content">
                           <div class="entry-body">
                              <ul>
  <li>Working on convertdb, a Perl script to read the UK database and convert it into GPDB</li>

  <li>Finished code to convert users. Using de to get info about a user to populate the GPDB fields</li>

  <li>Worked out problems with sites and got sites being added to GPDB from the UK database</li>

  <li>Got adding of PDB_CLEARCASE records preliminarily done</li>
</ul>
                              
                              <h2>convertdb</h2>

<p>Started coding a Perl script to attempt to convert the UK database to GPDB. Got the Users done then worked out the Site records. The Projects are harder because they contain both site and project as a pair as well as vob/view information. The goal is to get as much of the conversion done as I can as well as flush out issues. Then, at some point, change mkview_linked and mkvob_db to use this new database.</p>

<p>Apparently mkview_linked and mkvob_db utilize this UK database mainly for the purposes of obtaining defaults or a template of information for the creation of views or vobs. There are site-wide defaults, project defaults and finally command line overrides.</p>

<h2>GPDB requirements for mkview_link and mkvob_db</h2>

<p>I scanned the scripts mkview_link and mkvob_db in order to determine what exactly it needs from GPDB. Here's what I found. Below field names are <b>bold</b> where table names are both <b>bold</b> and <i>italic</i>.</p>

<h3>mkview_linked</h3>
<ul>
  <li>Obtains the <b>site</b> name in a table called <b><i>Sites</i> </b>where the <b>domain</b> field = the domain of the current host</li>

  <li>Gets all of the <b>project</b> and <b>stream</b> for this <b>site</b></li>

  <li>Obtains the following fields from a <b><i>Projects</i></b> table where the site = <b>site</b> and the <b>project</b> = "_default":</li>

  <ul>
    <li><b>site</b></li>

    <li><b>project</b></li>

    <li><b>vob_host</b></li>

    <li><b>vob_path</b></li>

    <li><b>vob_remote</b></li>

    <li><b>pool_postfix</b></li>

    <li><b>msdos_mode</b></li>

    <li><b>snap_to</b></li>

    <li><b>db_check</b></li>

    <li><b>snap_notify</b></li>

    <li><b>default_view</b></li>

    <li><b>umask</b></li>

    <li><b>group</b></li>

    <li><b>view_host</b>: Used in -host for mkview</li>

    <li><b>view_path</b>: Used in -hpath and -gpath for mkview  ($view_path/$username/$view.vws)</li>

    <li><b>view_remote</b>: If present then the view storage is placed remotely. Note this is Unix specific.</li>

    <li><b>msdos_view</b>: If present then a -tmode msdos style view is created.</li>

    <li><b>config_spec</b>: Path to a file containing this project's default config spec that is then set as the new view's config spec<sup>1</sup></li>

    <li><b>notify</b></li>

    <li><b>vob_only</b></li>

    <li><b>cachesize</b></li>

    <li><b>snapshot</b></li>

    <li><b>snapshot_workdir</b></li>

    <li><b>stream</b></li>
  </ul>

  <li>It then obtains the same file list from a <b><i>Projects</i></b> table where the site = <b>site</b> and the <b>project</b> = the project name. The idea here is that _default is the base and the project record then overrides those defaults.</li>

  <li>It then does some parameter substitutions for the field values above. Occurances of %USER% will be substituted with the current user, %PROJECT% the current project and strings of the form %SCRIPT()% will run the script defined between the (). The result of that will be the
substitution value.</p></li>
</ul>

<h4>Notes</h4>
<ol>
  <li>Variable substitution happens on each config spec line too. Occurances of %USER% are replaced with the username (%LCUSER% a lower case username and %UCUSER% an upper case username), %VIEW% with the current view (similar %LCVIEW% and %UCVIEW%), %PROJECT% -&gt; current project and %SITE% -&gt; site (with LC/UC versions too).</li>
</ol>

<h3>mkvob_db</h3>
<ul>
  <li>Obtains the <b>site</b> name in a table called <b><i>Sites</i> </b>where the <b>domain</b> field = the domain of the current host</li>

  <li>Obtains all fields from the the <b><i>Projects</i> </b>table for this <b>site</b></li>

  <li>Creates a $project_homes hash for each project/site combination with all fields from the <i><b>Projects</b></i> table</li>

  <li>Creates a @valid_projects array for each project.</li>

  <li>For each project, substitutes in to each field that is not defined from the site/project/_default record</li>

  <li>Performs the same substitution as described above on the various fields.</li>
</ul>
                              
                              <p class="entry-footer">
                                 <span class="post-footers">Posted by  at 12:29 PM</span> <span class="separator">|</span> <a class="permalink" href="http://defaria.com/blogs/Status/archives/000590.html">Permalink</a>
                                 
                                 
                              </p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</body>
</html>
